Return-Path: <owner-linux-mm@kvack.org>
Received: from mail6.bemta8.messagelabs.com (mail6.bemta8.messagelabs.com [216.82.243.55])
	by kanga.kvack.org (Postfix) with ESMTP id 784EC6B00A2
	for <linux-mm@kvack.org>; Wed, 23 Nov 2011 00:52:06 -0500 (EST)
Date: Tue, 22 Nov 2011 21:51:56 -0800 (PST)
From: Christian Kujau <lists@nerdbynature.de>
Subject: Re: WARNING: at mm/slub.c:3357, kernel BUG at mm/slub.c:3413
In-Reply-To: <1322007501.14573.15.camel@pasglop>
Message-ID: <alpine.DEB.2.01.1111222145470.8000@trent.utfs.org>
References: <20111121131531.GA1679@x4.trippels.de>  <1321884966.10470.2.camel@edumazet-HP-Compaq-6005-Pro-SFF-PC>  <20111121153621.GA1678@x4.trippels.de>  <1321890510.10470.11.camel@edumazet-HP-Compaq-6005-Pro-SFF-PC>  <20111121161036.GA1679@x4.trippels.de>
  <1321894353.10470.19.camel@edumazet-HP-Compaq-6005-Pro-SFF-PC>  <1321895706.10470.21.camel@edumazet-HP-Compaq-6005-Pro-SFF-PC>  <20111121173556.GA1673@x4.trippels.de>  <1321900743.10470.31.camel@edumazet-HP-Compaq-6005-Pro-SFF-PC>  <20111121185215.GA1673@x4.trippels.de>
  <20111121195113.GA1678@x4.trippels.de> <1321907275.13860.12.camel@pasglop>  <alpine.DEB.2.01.1111211617220.8000@trent.utfs.org>  <alpine.DEB.2.00.1111212105330.19606@router.home>  <1321948113.27077.24.camel@edumazet-laptop>  <1321999085.14573.2.camel@pasglop>
  <alpine.DEB.2.01.1111221511070.8000@trent.utfs.org> <1322007501.14573.15.camel@pasglop>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="-155031685-737418997-1322027516=:8000"
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Cc: Eric Dumazet <eric.dumazet@gmail.com>, Christoph Lameter <cl@linux.com>, Markus Trippelsdorf <markus@trippelsdorf.de>, "Alex,Shi" <alex.shi@intel.com>, "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>, "linux-mm@kvack.org" <linux-mm@kvack.org>, Pekka Enberg <penberg@kernel.org>, Matt Mackall <mpm@selenic.com>, "netdev@vger.kernel.org" <netdev@vger.kernel.org>, Tejun Heo <tj@kernel.org>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---155031685-737418997-1322027516=:8000
Content-Type: TEXT/PLAIN; charset=US-ASCII

On Wed, 23 Nov 2011 at 11:18, Benjamin Herrenschmidt wrote:
> I'd say only this one liner for now, just don't do slabinfo :-) I just
> want to see whether your network + heavy IO load problem goes away with
> that one patch.

OK, with Christoph's patch applied, 3.2.0-rc2-00274-g6fe4c6d-dirty survives 
on this machine, with the disk & cpu workload that caused the machine to 
panic w/o the patch. Load was at 4-5 this time, which is expected for this 
box. I'll run a few more tests later on, but it seems ok for now.

I couldn't resist and ran "slabinfo" anyway (after the workload!) - the 
box survived, nothing was printed in syslog either. Output attached.

Thanks!
Christian.

--- linux-2.6.orig/mm/slub.c	2011-11-21 21:15:41.575673204 -0600
+++ linux-2.6/mm/slub.c	2011-11-21 21:16:33.442336849 -0600
@@ -1969,7 +1969,7 @@
 		page->pobjects = pobjects;
 		page->next = oldpage;

-	} while (this_cpu_cmpxchg(s->cpu_slab->partial, oldpage, page) != oldpage);
+	} while (irqsafe_cpu_cmpxchg(s->cpu_slab->partial, oldpage, page) != oldpage);
 	stat(s, CPU_PARTIAL_FREE);
 	return pobjects;
 }

-- 
BOFH excuse #6:

global warming
---155031685-737418997-1322027516=:8000
Content-Type: TEXT/plain; name=slabinfo.txt
Content-Transfer-Encoding: BASE64
Content-ID: <alpine.DEB.2.01.1111222151560.8000@trent.utfs.org>
Content-Description: 
Content-Disposition: attachment; filename=slabinfo.txt

TmFtZSAgICAgICAgICAgICAgICAgICBPYmplY3RzIE9ianNpemUgICAgU3Bh
Y2UgU2xhYnMvUGFydC9DcHUgIE8vUyBPICVGciAlRWYgRmxnDQo6YXQtMDAw
MDA0MCAgICAgICAgICAgICAgICAxMDIgICAgICAzNiAgICAgNC4wSyAgICAg
ICAgICAwLzAvMSAgMTAyIDAgICAwICA4OSAqYQ0KOmF0LTAwMDAwNjQgICAg
ICAgICAgICAgIDQxMjg4ICAgICAgNjQgICAgIDQuME0gICAgIDk2NC81NjUv
MTUgICA2NCAwICA1NyAgNjUgKmENCjp0LTAwMDAwMDggICAgICAgICAgICAg
ICAgMjA0OCAgICAgICA4ICAgIDE2LjNLIDQyOTQ5NjcwNzgvMC8yMjIgIDUx
MiAwICAgMCAxMDAgKg0KOnQtMDAwMDAxNiAgICAgICAgICAgICAgICAyNjI0
ICAgICAgMTYgICAgOTQuMksgNDI5NDk2NzA2OS8xNS8yNTAgIDI1NiAwICA2
NSAgNDQgKg0KOnQtMDAwMDAyNCAgICAgICAgICAgICAgICAzMjc5ICAgICAg
MjQgICAgOTguM0sgICAgICAgIDE5LzE3LzUgIDE3MCAwICA3MCAgODAgKg0K
OnQtMDAwMDAzMiAgICAgICAgICAgICAgICAgNzUwICAgICAgMzIgICAgMjgu
NksgNDI5NDk2NzE3NS80LzEyOCAgMTI4IDAgIDU3ICA4MyAqDQo6dC0wMDAw
MDU2ICAgICAgICAgICAgICAgICA3NzEgICAgICA1NiAgICA2OS42SyAgICAg
ICAgIDE3LzcvMCAgIDczIDAgIDQxICA2MiAqDQo6dC0wMDAwMDY0ICAgICAg
ICAgICAgICAgIDUyMjYgICAgICA2NCAgIDYxMC4zSyAgICAgMTM3LzEwMS8x
MiAgIDY0IDAgIDY3ICA1NCAqDQo6dC0wMDAwMDcyICAgICAgICAgICAgICAg
ICAxMTIgICAgICA3MiAgICAgOC4xSyA0Mjk0OTY3MjUzLzAvNDUgICA1NiAw
ICAgMCAgOTggKg0KOnQtMDAwMDA4OCAgICAgICAgICAgICAgICA0MDEzICAg
ICAgODggICAzNjAuNEsgICAgICAgIDY5LzMvMTkgICA0NiAwICAgMyAgOTcg
Kg0KOnQtMDAwMDA5NiAgICAgICAgICAgICAgICA5MTg0ICAgICAgOTYgICAg
IDEuME0gICAgICAyMzkvNzIvMjMgICA0MiAwICAyNyAgODIgKg0KOnQtMDAw
MDEwNCAgICAgICAgICAgICAgICAgIDI2ICAgICAxMDQgICAgIDQuMEsgICAg
ICAgICAgMS8xLzAgICAzOSAwIDEwMCAgNjYgKg0KOnQtMDAwMDEyOCAgICAg
ICAgICAgICAgICAyMTI3ICAgICAxMjggICA1MTIuMEsgICAgICAxMDYvOTEv
MTkgICAzMiAwICA3MiAgNTMgKg0KOnQtMDAwMDE0NCAgICAgICAgICAgICAg
ICAgIDU2ICAgICAxNDQgICAgIDguMUsgNDI5NDk2NzI2OS8wLzI5ICAgMjgg
MCAgIDAgIDk4ICoNCjp0LTAwMDAxNTIgICAgICAgICAgICAgICAgIDQzMCAg
ICAgMTUyICAgMTQ3LjRLICAgICAgIDExLzI5LzI1ICAgMjYgMCAgODAgIDQ0
ICoNCjp0LTAwMDAxNjAgICAgICAgICAgICAgICAgNzAwMCAgICAgMTYwICAg
ICAxLjFNICAgICAgIDI2OC8wLzEyICAgMjUgMCAgIDAgIDk3ICpBDQo6dC0w
MDAwMTkyICAgICAgICAgICAgICAgIDI5NTkgICAgIDE5MiAgIDYzOC45SyAg
ICAgICAxNDcvMjQvOSAgIDIxIDAgIDE1ICA4OCAqDQo6dC0wMDAwMzIwICAg
ICAgICAgICAgICAgIDk0ODIgICAgIDMyMCAgICAgMy42TSAgICAgIDg3OS8x
NjcvMCAgIDEyIDAgIDE4ICA4NCAqQQ0KOnQtMDAwMDM1MiAgICAgICAgICAg
ICAgICAgIDMxICAgICAzNTIgICAgMjQuNUsgICAgICAgICAgNC80LzIgICAx
MSAwICA2NiAgNDQgKkENCjp0LTAwMDA0ODAgICAgICAgICAgICAgICAgICAz
NiAgICAgNDgwICAgIDIwLjRLICAgICAgICAgIDUvMS8wICAgIDggMCAgMjAg
IDg0ICpBDQo6dC0wMDAwNzM2ICAgICAgICAgICAgICAgICAgIDIgICAgIDcy
OCAgICAgOC4xSyAgICAgICAgICAxLzEvMCAgIDExIDEgMTAwICAxNyAqQQ0K
OnQtMDAwMDc2OCAgICAgICAgICAgICAgICAgMjY4ICAgICA3NjggICAyNTMu
OUsgICAgICAgICAyNS85LzYgICAxMCAxICAyOSAgODEgKkENCjp0LTAwMDIw
NDggICAgICAgICAgICAgICAgIDI1NiAgICAyMDQ4ICAgNTczLjRLICAgICAg
ICAgMzEvNi80ICAgIDggMiAgMTcgIDkxICoNCjp0LTAwMDQwOTYgICAgICAg
ICAgICAgICAgIDE2OCAgICA0MDk2ICAgNzIwLjhLICAgICAgICAgMjAvMS8y
ICAgIDggMyAgIDQgIDk1ICoNCmFub25fdm1hICAgICAgICAgICAgICAgICAg
MjExNyAgICAgIDg4ICAgMjE3LjBLICAgICAgICAgNTEvNC8yICAgNDIgMCAg
IDcgIDg1IA0KYXJwX2NhY2hlICAgICAgICAgICAgICAgICAgICA2ICAgICAz
ODAgICAgIDQuMEsgICAgICAgICAgMS8xLzAgICAxMCAwIDEwMCAgNTUgQQ0K
YmRldl9jYWNoZSAgICAgICAgICAgICAgICAgIDI1ICAgICA3NDQgICAgMjQu
NUsgICAgICAgICAgMy8xLzAgICAxMCAxICAzMyAgNzUgQWENCmJpb3ZlYy0x
MjggICAgICAgICAgICAgICAgICAyMCAgICAxNTM2ICAgIDMyLjdLIDQyOTQ5
NjcyODcvMC8xMSAgIDEwIDIgICAwICA5MyBBDQpiaW92ZWMtMjU2ICAgICAg
ICAgICAgICAgICAgOTggICAgMzA3MiAgIDM2MC40SyAgICAgICAgIDExLzIv
MCAgIDEwIDMgIDE4ICA4MyBBDQpibGtkZXZfcXVldWUgICAgICAgICAgICAg
ICAgMTUgICAgMTI0MCAgICAzMi43SyAgICAgICAgICAyLzEvMCAgIDEzIDIg
IDUwICA1NiANCmJsa2Rldl9yZXF1ZXN0cyAgICAgICAgICAgICA2MiAgICAg
MjE2ICAgIDI0LjVLIDQyOTQ5NjcyNzMvMy8yOSAgIDE4IDAgIDUwICA1NCAN
CmRlbnRyeSAgICAgICAgICAgICAgICAgIDIxOTI1OSAgICAgMTYwICAgIDM2
LjNNICAgIDg4NDIvMjI0LzIxICAgMjUgMCAgIDIgIDk2IGENCmV2ZW50cG9s
bF9wd3EgICAgICAgICAgICAgICA5MiAgICAgIDM2ICAgIDIwLjRLICAgICAg
ICAgIDUvNS8wICAxMDIgMCAxMDAgIDE2IA0KZXh0NF9hbGxvY2F0aW9uX2Nv
bnRleHQgICAgICAgIDAgICAgIDEwOCAgICAgNC4wSyAgICAgICAgICAxLzEv
MCAgIDM2IDAgMTAwICAgMCBhDQpleHQ0X2dyb3VwaW5mb180ayAgICAgICAg
IDc0OTggICAgIDE0OCAgICAgMS4xTSAgICAgICAgMjg5LzEvMCAgIDI2IDAg
ICAwICA5MyBhDQpleHQ0X2lub2RlX2NhY2hlICAgICAgICAyMDYyMjIgICAg
IDkzNiAgIDE5OS42TSAgICAxMjE3Ny8xNTkvOCAgIDE3IDIgICAxICAxMCBh
DQpleHQ0X2lvX2VuZCAgICAgICAgICAgICAgICAgMTMgICAgIDU5MiAgICAg
OC4xSyAgICAgICAgICAwLzAvMSAgIDEzIDEgICAwICA5MyBhDQpleHQ0X2lv
X3BhZ2UgICAgICAgICAgICAgICA1MTIgICAgICAgOCAgICAgNC4wSyAgICAg
ICAgICAwLzAvMSAgNTEyIDAgICAwIDEwMCBhDQpleHQ0X3ByZWFsbG9jX3Nw
YWNlICAgICAgICAgMTcgICAgICA5NiAgICAgNC4wSyAgICAgICAgICAxLzEv
MCAgIDQyIDAgMTAwICAzOSBhDQpmaWxlc19jYWNoZSAgICAgICAgICAgICAg
ICAgOTAgICAgIDIwOCAgICAyMC40SyA0Mjk0OTY3Mjg4LzAvMTMgICAxOCAw
ICAgMCAgOTEgQQ0KaW5vZGVfY2FjaGUgICAgICAgICAgICAgICAzNzM1ICAg
ICA1MTIgICAgIDIuME0gICAgICAgIDI0OC8wLzEgICAxNSAxICAgMCAgOTMg
YQ0KamJkMl9yZXZva2VfcmVjb3JkICAgICAgICAgICAwICAgICAgMjQgICAg
IDQuMEsgICAgICAgICAgMS8xLzAgIDEyOCAwIDEwMCAgIDAgQWENCmpiZDJf
cmV2b2tlX3RhYmxlICAgICAgICAgICAgNCAgICAgIDEyICAgICA0LjBLICAg
ICAgICAgIDEvMS8wICAyNTYgMCAxMDAgICAxIGENCmttYWxsb2MtMTAyNCAg
ICAgICAgICAgICAgIDMxMCAgICAxMDI0ICAgMzUyLjJLICAgICAgICAgMzYv
Ny83ICAgIDggMSAgMTYgIDkwIA0Ka21hbGxvYy0yNTYgICAgICAgICAgICAg
ICAgMTEwICAgICAyNTYgICAgNjUuNUsgICAgICAgIDQvMTMvMTIgICAxNiAw
ICA4MSAgNDIgDQprbWFsbG9jLTUxMiAgICAgICAgICAgICAgICA1MzIgICAg
IDUxMiAgIDI4Mi42SyAgICAgICAgNTgvNS8xMSAgICA4IDAgICA3ICA5NiAN
CmttYWxsb2MtODE5MiAgICAgICAgICAgICAgICAgNyAgICA4MTkyICAgIDk4
LjNLICAgICAgICAgIDMvMi8wICAgIDQgMyAgNjYgIDU4IA0Ka21lbV9jYWNo
ZSAgICAgICAgICAgICAgICAgIDI4ICAgICAxMTYgICAgIDQuMEsgICAgICAg
ICAgMS8xLzAgICAzMiAwIDEwMCAgNzkgKkENCmttZW1fY2FjaGVfbm9kZSAg
ICAgICAgICAgIDEwMCAgICAgIDYwICAgICA4LjFLICAgICAgICAgIDIvMS8w
ICAgNjQgMCAgNTAgIDczICpBDQptbV9zdHJ1Y3QgICAgICAgICAgICAgICAg
ICAgNzAgICAgIDU0MCAgICA0OS4xSyAgICAgICAgICA0LzQvMiAgIDE1IDEg
IDY2ICA3NiBBDQptcXVldWVfaW5vZGVfY2FjaGUgICAgICAgICAgIDEgICAg
IDc0NCAgICAgOC4xSyAgICAgICAgICAxLzEvMCAgIDEwIDEgMTAwICAgOSBB
DQpuZGlzY19jYWNoZSAgICAgICAgICAgICAgICAgIDIgICAgIDM5MiAgICAg
OC4xSyAgICAgICAgICAxLzEvMCAgIDE5IDEgMTAwICAgOSBBDQpwb3NpeF90
aW1lcnNfY2FjaGUgICAgICAgICAgIDAgICAgIDEzNiAgICAgNC4wSyAgICAg
ICAgICAxLzEvMCAgIDMwIDAgMTAwICAgMCANCnByb2NfaW5vZGVfY2FjaGUg
ICAgICAgICAgMTE5NCAgICAgNTQ0ICAgNzUzLjZLICAgICAgIDc5LzI0LzEz
ICAgMTQgMSAgMjYgIDg2IGENCnJhZGl4X3RyZWVfbm9kZSAgICAgICAgICAx
NzkzNCAgICAgMjk2ICAgICA2LjhNICAgIDE2NjkvOTYyLzE0ICAgMTMgMCAg
NTcgIDc3IGENClJBV3Y2ICAgICAgICAgICAgICAgICAgICAgICAgNSAgICAg
ODk2ICAgICA4LjFLICAgICAgICAgIDEvMS8wICAgIDkgMSAxMDAgIDU0IEEN
CnJwY19pbm9kZV9jYWNoZSAgICAgICAgICAgICAxMiAgICAgNjgwICAgIDE2
LjNLICAgICAgICAgIDIvMS8wICAgMTEgMSAgNTAgIDQ5IEFhDQpzZ3Bvb2wt
MTI4ICAgICAgICAgICAgICAgICAgIDIgICAgMjU2MCAgICAzMi43SyAgICAg
ICAgICAxLzEvMCAgIDEyIDMgMTAwICAxNSBBDQpzZ3Bvb2wtMzIgICAgICAg
ICAgICAgICAgICAgIDIgICAgIDY0MCAgICAgOC4xSyAgICAgICAgICAxLzEv
MCAgIDEyIDEgMTAwICAxNSBBDQpzZ3Bvb2wtNjQgICAgICAgICAgICAgICAg
ICAgIDIgICAgMTI4MCAgICAxNi4zSyAgICAgICAgICAxLzEvMCAgIDEyIDIg
MTAwICAxNSBBDQpzaG1lbV9pbm9kZV9jYWNoZSAgICAgICAgICA3MDAgICAg
IDU3NiAgIDQwOS42SyAgICAgICAgIDQyLzAvOCAgIDE0IDEgICAwICA5OCAN
CnNpZ2hhbmRfY2FjaGUgICAgICAgICAgICAgIDE0MSAgICAxMzU2ICAgMjI5
LjNLICAgICAgICAgIDMvMy80ICAgMjMgMyAgNDIgIDgzIEENCnNvY2tfaW5v
ZGVfY2FjaGUgICAgICAgICAgIDIyNSAgICAgNTQ0ICAgMTU1LjZLICAgICAg
ICAgMS83LzE4ICAgMTQgMSAgMzYgIDc4IEFhDQp0YXNrX2RlbGF5X2luZm8g
ICAgICAgICAgICAxNTkgICAgIDExMiAgICAyMC40SyA0Mjk0OTY3Mjk1LzEv
NiAgIDM2IDAgIDIwICA4NiANCnRhc2tfc3RydWN0ICAgICAgICAgICAgICAg
IDE0MyAgICAyOTkyICAgNTI0LjJLICAgICAgICAgMTEvNS81ICAgMTAgMyAg
MzEgIDgxIA0KdGFza3N0YXRzICAgICAgICAgICAgICAgICAgICAxICAgICAz
MjggICAgIDQuMEsgICAgICAgICAgMS8xLzAgICAxMiAwIDEwMCAgIDggDQpU
Q1AgICAgICAgICAgICAgICAgICAgICAgICAgNTkgICAgMTQ4MCAgIDI2Mi4x
SyAgICAgICAgICAyLzYvNiAgIDIxIDMgIDc1ICAzMyBBDQpUQ1B2NiAgICAg
ICAgICAgICAgICAgICAgICAgIDYgICAgMTYxNiAgICAxNi4zSyAgICAgICAg
ICAxLzEvMCAgIDEwIDIgMTAwICA1OSBBDQp0d19zb2NrX1RDUCAgICAgICAg
ICAgICAgICAgMTAgICAgIDEwNCAgICAgNC4wSyAgICAgICAgICAxLzEvMCAg
IDMyIDAgMTAwICAyNSBBDQpVRFAgICAgICAgICAgICAgICAgICAgICAgICAg
MzAgICAgIDc0NCAgICAyNC41SyAgICAgICAgICAyLzAvMSAgIDEwIDEgICAw
ICA5MCBBDQpVRFB2NiAgICAgICAgICAgICAgICAgICAgICAgIDkgICAgIDg4
MCAgICAgOC4xSyAgICAgICAgICAwLzAvMSAgICA5IDEgICAwICA5NiBBDQp4
ZnNfZGFfc3RhdGUgICAgICAgICAgICAgICAgIDAgICAgIDM5MiAgICAgNC4w
SyAgICAgICAgICAxLzEvMCAgIDEwIDAgMTAwICAgMCANCnhmc19pbm9kZSAg
ICAgICAgICAgICAgIDE5MjI3MCAgICAgOTg0ICAgMjAwLjlNICAgMjQ1MzMv
MTE5OS8wICAgIDggMSAgIDQgICA4IEFhDQp4ZnNfbG9nX3RpY2tldCAgICAg
ICAgICAgICAgIDEgICAgIDIwOCAgICAgNC4wSyAgICAgICAgICAxLzEvMCAg
IDE5IDAgMTAwICAgNSANCg==

---155031685-737418997-1322027516=:8000--

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Fight unfair telecom internet charges in Canada: sign http://stopthemeter.ca/
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
