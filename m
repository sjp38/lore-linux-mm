Return-Path: <owner-linux-mm@kvack.org>
Received: from mail172.messagelabs.com (mail172.messagelabs.com [216.82.254.3])
	by kanga.kvack.org (Postfix) with ESMTP id 6C2586B0115
	for <linux-mm@kvack.org>; Wed, 13 May 2009 12:18:30 -0400 (EDT)
Message-ID: <4A0AF2DA.2020404@zytor.com>
Date: Wed, 13 May 2009 09:18:34 -0700
From: "H. Peter Anvin" <hpa@zytor.com>
MIME-Version: 1.0
Subject: Re: [PATCH] x86: Extend test_and_set_bit() test_and_clean_bit() to
 64 bits in X86_64
References: <1242202647-32446-1-git-send-email-sheng@linux.intel.com>
In-Reply-To: <1242202647-32446-1-git-send-email-sheng@linux.intel.com>
Content-Type: multipart/mixed;
 boundary="------------060805040508090909070102"
Sender: owner-linux-mm@kvack.org
To: Sheng Yang <sheng@linux.intel.com>
Cc: linux-kernel@vger.kernel.org, linux-mm <linux-mm@kvack.org>, Ingo Molnar <mingo@elte.hu>
List-ID: <linux-mm.kvack.org>

This is a multi-part message in MIME format.
--------------060805040508090909070102
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

Sheng Yang wrote:
> This fix 44/45 bit width memory can't boot up issue. The reason is
> free_bootmem_node()->mark_bootmem_node()->__free() use test_and_clean_bit() to
> clean node_bootmem_map, but for 44bits width address, the idx set bit 31 (43 -
> 12), which consider as a nagetive value for bts.
> 
> This patch applied to tip/mm.

Hi Sheng,

Could you try the attached patch instead?

	-hpa

-- 
H. Peter Anvin, Intel Open Source Technology Center
I work for Intel.  I don't speak on their behalf.


--------------060805040508090909070102
Content-Type: text/plain;
 name="diff"
Content-Transfer-Encoding: base64
Content-Disposition: inline;
 filename="diff"

ZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24veDg2L2Jvb3QudHh0IGIvRG9jdW1lbnRhdGlv
bi94ODYvYm9vdC50eHQKaW5kZXggZTAyMDM2Ni4uY2NjMWJkNCAxMDA2NDQKLS0tIGEvRG9j
dW1lbnRhdGlvbi94ODYvYm9vdC50eHQKKysrIGIvRG9jdW1lbnRhdGlvbi94ODYvYm9vdC50
eHQKQEAgLTUwLDYgKzUwLDExIEBAIFByb3RvY29sIDIuMDg6CShLZXJuZWwgMi42LjI2KSBB
ZGRlZCBjcmMzMiBjaGVja3N1bSBhbmQgRUxGIGZvcm1hdAogUHJvdG9jb2wgMi4wOToJKEtl
cm5lbCAyLjYuMjYpIEFkZGVkIGEgZmllbGQgb2YgNjQtYml0IHBoeXNpY2FsCiAJCXBvaW50
ZXIgdG8gc2luZ2xlIGxpbmtlZCBsaXN0IG9mIHN0cnVjdAlzZXR1cF9kYXRhLgogCitQcm90
b2NvbCAyLjEwOgkoS2VybmVsIDIuNi4zMT8pIEEgcHJvdG9jb2wgZm9yIHJlbGF4ZWQgYWxp
Z25tZW50CisJIAliZXlvbmQgdGhlIGtlcm5lbF9hbGlnbm1lbnQgYWRkZWQsIG5ldyBpbml0
X3NpemUgYW5kCisJIAlwcmVmX2FkZHJlc3MgZmllbGRzLgorCSAJCisKICoqKiogTUVNT1JZ
IExBWU9VVAogCiBUaGUgdHJhZGl0aW9uYWwgbWVtb3J5IG1hcCBmb3IgdGhlIGtlcm5lbCBs
b2FkZXIsIHVzZWQgZm9yIEltYWdlIG9yCkBAIC0xNzMsNyArMTc4LDcgQEAgT2Zmc2V0CVBy
b3RvCU5hbWUJCU1lYW5pbmcKIDAyMkMvNAkyLjAzKwlyYW1kaXNrX21heAlIaWdoZXN0IGxl
Z2FsIGluaXRyZCBhZGRyZXNzCiAwMjMwLzQJMi4wNSsJa2VybmVsX2FsaWdubWVudCBQaHlz
aWNhbCBhZGRyIGFsaWdubWVudCByZXF1aXJlZCBmb3Iga2VybmVsCiAwMjM0LzEJMi4wNSsJ
cmVsb2NhdGFibGVfa2VybmVsIFdoZXRoZXIga2VybmVsIGlzIHJlbG9jYXRhYmxlIG9yIG5v
dAotMDIzNS8xCU4vQQlwYWQyCQlVbnVzZWQKKzAyMzUvMQkyLjEwKwltaW5fYWxpZ25tZW50
CU1pbmltdW0gYWxpZ25tZW50LCBhcyBhIHBvd2VyIG9mIDIKIDAyMzYvMglOL0EJcGFkMwkJ
VW51c2VkCiAwMjM4LzQJMi4wNisJY21kbGluZV9zaXplCU1heGltdW0gc2l6ZSBvZiB0aGUg
a2VybmVsIGNvbW1hbmQgbGluZQogMDIzQy80CTIuMDcrCWhhcmR3YXJlX3N1YmFyY2ggSGFy
ZHdhcmUgc3ViYXJjaGl0ZWN0dXJlCkBAIC0xODIsNiArMTg3LDggQEAgT2Zmc2V0CVByb3Rv
CU5hbWUJCU1lYW5pbmcKIDAyNEMvNAkyLjA4KwlwYXlsb2FkX2xlbmd0aAlMZW5ndGggb2Yg
a2VybmVsIHBheWxvYWQKIDAyNTAvOAkyLjA5KwlzZXR1cF9kYXRhCTY0LWJpdCBwaHlzaWNh
bCBwb2ludGVyIHRvIGxpbmtlZCBsaXN0CiAJCQkJb2Ygc3RydWN0IHNldHVwX2RhdGEKKzAy
NTgvOAkyLjEwKwlwcmVmX2FkZHJlc3MJUHJlZmVycmVkIGxvYWRpbmcgYWRkcmVzcworMDI2
MC80CTIuMTArCWluaXRfc2l6ZQlMaW5lYXIgbWVtb3J5IHJlcXVpcmVkIGR1cmluZyBpbml0
aWFsaXphdGlvbgogCiAoMSkgRm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LCBpZiB0aGUg
c2V0dXBfc2VjdHMgZmllbGQgY29udGFpbnMgMCwgdGhlCiAgICAgcmVhbCB2YWx1ZSBpcyA0
LgpAQCAtNDgyLDExICs0ODksMTUgQEAgUHJvdG9jb2w6CTIuMDMrCiAgIDB4MzdGRkZGRkYs
IHlvdSBjYW4gc3RhcnQgeW91ciByYW1kaXNrIGF0IDB4MzdGRTAwMDAuKQogCiBGaWVsZCBu
YW1lOglrZXJuZWxfYWxpZ25tZW50Ci1UeXBlOgkJcmVhZCAocmVsb2MpCitUeXBlOgkJcmVh
ZC9tb2RpZnkgKHJlbG9jKQogT2Zmc2V0L3NpemU6CTB4MjMwLzQKLVByb3RvY29sOgkyLjA1
KworUHJvdG9jb2w6CTIuMDUrIChyZWFkKSwgMi4xMCsgKG1vZGlmeSkKIAotICBBbGlnbm1l
bnQgdW5pdCByZXF1aXJlZCBieSB0aGUga2VybmVsIChpZiByZWxvY2F0YWJsZV9rZXJuZWwg
aXMgdHJ1ZS4pCisgIEFsaWdubWVudCB1bml0IHJlcXVpcmVkIGJ5IHRoZSBrZXJuZWwgKGlm
IHJlbG9jYXRhYmxlX2tlcm5lbCBpcworICB0cnVlLikgIFN0YXJ0aW5nIHdpdGggcHJvdG9j
b2wgdmVyc2lvbiAyLjEwLCB0aGlzIHJlZmxlY3RzIHRoZQorICBrZXJuZWwgYWxpZ25tZW50
IHByZWZlcnJlZCBmb3Igb3B0aW1hbCBwZXJmb3JtYW5jZSBhbmQgY2FuIGJlCisgIG1vZGlm
aWVkIGJ5IHRoZSBsb2FkZXI7IHNlZSB0aGUgbWluX2FsaWdubWVudCBhbmQgcHJlZl9hZGRy
ZXNzIGZpZWxkCisgIGJlbG93LgogCiBGaWVsZCBuYW1lOglyZWxvY2F0YWJsZV9rZXJuZWwK
IFR5cGU6CQlyZWFkIChyZWxvYykKQEAgLTQ5OCw2ICs1MDksMjIgQEAgUHJvdG9jb2w6CTIu
MDUrCiAgIEFmdGVyIGxvYWRpbmcsIHRoZSBib290IGxvYWRlciBtdXN0IHNldCB0aGUgY29k
ZTMyX3N0YXJ0IGZpZWxkIHRvCiAgIHBvaW50IHRvIHRoZSBsb2FkZWQgY29kZSwgb3IgdG8g
YSBib290IGxvYWRlciBob29rLgogCitGaWVsZCBuYW1lOgltaW5fYWxpZ25tZW50CitUeXBl
OgkJcmVhZCAocmVsb2MpCitPZmZzZXQvc2l6ZToJMHgyMzUvMQorUHJvdG9jb2w6CTIuMTAr
CisKKyAgVGhpcyBmaWVsZCwgaWYgbm9uemVybywgaW5kaWNhdGVzIGFzIGEgcG93ZXIgb2Yg
MiB0aGUgbWluaW11bQorICBhbGlnbm1lbnQgcmVxdWlyZWQsIGFzIG9wcG9zZWQgdG8gcHJl
ZmVycmVkLCBieSB0aGUga2VybmVsIHRvIGJvb3QuCisgIElmIGEgYm9vdCBsb2FkZXIgbWFr
ZXMgdXNlIG9mIHRoaXMgZmllbGQsIGl0IHNob3VsZCB1cGRhdGUgdGhlCisgIGtlcm5lbF9h
bGlnbm1lbnQgZmllbGQgd2l0aCB0aGUgYWxpZ25tZW50IHVuaXQgZGVzaXJlZDsgdHlwaWNh
bGx5OgorCisJa2VybmVsX2FsaWdubWVudCA9IDEgPDwgbWluX2FsaWdubWVudAorCisgIFRo
ZXJlIG1heSBiZSBhIGNvbnNpZGVyYWJsZSBwZXJmb3JtYW5jZSBjb3N0IHdpdGggYW4gZXhj
ZXNzaXZlbHkKKyAgbWlzYWxpZ25lZCBrZXJuZWwuICBUaGVyZWZvcmUsIGEgbG9hZGVyIHNo
b3VsZCB0eXBpY2FsbHkgdHJ5IGVhY2gKKyAgcG93ZXItb2YtdHdvIGFsaWdubWVudCBmcm9t
IGtlcm5lbF9hbGlnbm1lbnQgZG93biB0byB0aGlzIGFsaWdubWVudC4KKwogRmllbGQgbmFt
ZToJY21kbGluZV9zaXplCiBUeXBlOgkJcmVhZAogT2Zmc2V0L3NpemU6CTB4MjM4LzQKQEAg
LTU4Miw2ICs2MDksMjcgQEAgUHJvdG9jb2w6CTIuMDkrCiAgIHN1cmUgdG8gY29uc2lkZXIg
dGhlIGNhc2Ugd2hlcmUgdGhlIGxpbmtlZCBsaXN0IGFscmVhZHkgY29udGFpbnMKICAgZW50
cmllcy4KIAorRmllbGQgbmFtZToJcHJlZl9hZGRyZXNzCitUeXBlOgkJcmVhZCAocmVsb2Mp
CitPZmZzZXQvc2l6ZToJMHgyNTgvOAorUHJvdG9jb2w6CTIuMTArCisKKyAgVGhpcyBmaWVs
ZCwgaWYgbm9uemVybywgcmVwcmVzZW50cyBhIHByZWZlcnJlZCBsb2FkIGFkZHJlc3MgZm9y
IHRoZQorICBrZXJuZWwuICBBIHJlbG9jYXRpbmcgYm9vdGxvYWRlciBzaG91bGQgYXR0ZW1w
dCB0byBsb2FkIGF0IHRoaXMKKyAgYWRkcmVzcyBpZiBwb3NzaWJsZS4KKworCitGaWVsZCBu
YW1lOglpbml0X3NpemUKK1R5cGU6CQlyZWFkCitPZmZzZXQvc2l6ZToJMHgyNWMvNAorCisg
IFRoaXMgZmllbGQgaW5kaWNhdGVzIHRoZSBhbW91bnQgb2YgbGluZWFyIGNvbnRpZ3VvdXMg
bWVtb3J5IHN0YXJ0aW5nCisgIGF0IHRoZSBrZXJuZWwgbG9hZCBhZGRyZXNzIChyb3VuZGVk
IHVwIHRvIGtlcm5lbF9hbGlnbm1lbnQpIHRoYXQgdGhlCisgIGtlcm5lbCBuZWVkcyBiZWZv
cmUgaXQgaXMgY2FwYWJsZSBvZiBleGFtaW5pbmcgaXRzIG1lbW9yeSBtYXAuICBUaGlzCisg
IGlzIG5vdCB0aGUgc2FtZSB0aGluZyBhcyB0aGUgdG90YWwgYW1vdW50IG9mIG1lbW9yeSB0
aGUga2VybmVsIG5lZWRzCisgIHRvIGJvb3QsIGJ1dCBpdCBjYW4gYmUgdXNlZCBieSBhIHJl
bG9jYXRpbmcgYm9vdCBsb2FkZXIgdG8gaGVscAorICBzZWxlY3QgYSBzYWZlIGxvYWQgYWRk
cmVzcyBmb3IgdGhlIGtlcm5lbC4KKwogCiAqKioqIFRIRSBJTUFHRSBDSEVDS1NVTQogCg==
--------------060805040508090909070102--

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
