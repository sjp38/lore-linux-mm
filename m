Return-Path: <owner-linux-mm@kvack.org>
Received: from mail-oi0-f49.google.com (mail-oi0-f49.google.com [209.85.218.49])
	by kanga.kvack.org (Postfix) with ESMTP id 904C96B0032
	for <linux-mm@kvack.org>; Tue, 28 Apr 2015 21:11:37 -0400 (EDT)
Received: by oift201 with SMTP id t201so10452243oif.3
        for <linux-mm@kvack.org>; Tue, 28 Apr 2015 18:11:37 -0700 (PDT)
Received: from unicom146.biz-email.net (unicom146.biz-email.net. [210.51.26.146])
        by mx.google.com with ESMTPS id l8si16856092oeu.107.2015.04.28.18.11.33
        for <linux-mm@kvack.org>
        (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);
        Tue, 28 Apr 2015 18:11:36 -0700 (PDT)
Date: Wed, 29 Apr 2015 09:11:02 +0800
From: "songxiumiao@inspur.com" <songxiumiao@inspur.com>
Subject: Re: Re: [PATCH] of: return NUMA_NO_NODE from fallback of_node_to_nid()
References: <20150408165920.25007.6869.stgit@buzz>,
	<CAL_JsqKQPtNPfTAiqsKnFuU6e-qozzPgujM=8MHseG75R9cbSA@mail.gmail.com>,
	<552BC6E8.1040400@yandex-team.ru>,
	<CAL_Jsq+vaufZJAchHC1OaV9g18zFfkXyRZ9j5wm0VWosh9i4kQ@mail.gmail.com>
MIME-Version: 1.0
Message-ID: <201504290910595113455@inspur.com>
Content-Type: multipart/alternative;
	boundary="----=_001_NextPart033685720058_=----"
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Rob Herring <robherring2@gmail.com>, Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Cc: Grant Likely <grant.likely@linaro.org>, "devicetree@vger.kernel.org" <devicetree@vger.kernel.org>, Rob Herring <robh+dt@kernel.org>, "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>, "sparclinux@vger.kernel.org" <sparclinux@vger.kernel.org>, "linux-mm@kvack.org" <linux-mm@kvack.org>, linuxppc-dev <linuxppc-dev@lists.ozlabs.org>, yanxiaofeng <yanxiaofeng@inspur.com>

------=_001_NextPart033685720058_=----
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: base64

V2hlbiB3ZSB0ZXN0IHRoZSBjcHUgYW5kIG1lbW9yeSBob3RwbHVnIGZlYXR1cmUgaW4gdGhlIHNl
cnZlciB3aXRoIHg4NiBhcmNoaXRlY3R1cmUgYW5kIGtlcm5lbDQuMC1yYzQsd2UgbWV0IHRoZSBz
aW1pbGFyIHByb2JsZW0uDQoNCg0KVGhlIHNpdHVhdGlvbiBpcyB0aGF0IHdoZW4gbWVtb3J5IGlu
IG5vZGUwIGlzIG9mZmxpbmUsdGhlIHN5c3RlbSBpcyBkb3duIGR1cmluZyBib290aW5nLg0KDQpG
b2xsb3dpbmcgaXMgdGhlIGJ1ZyBpbmZvcm1hdGlvbjoNCg0KWyAgICAwLjMzNTE3Nl0gQlVHOiB1
bmFibGUgdG8gaGFuZGxlIGtlcm5lbCBwYWdpbmcgcmVxdWVzdCBhdCAwMDAwMDAwMDAwMDAxYjA4
DQpbICAgIDAuMzQyMTY0XSBJUDogWzxmZmZmZmZmZjgxMTgyNTg3Pl0gX19hbGxvY19wYWdlc19u
b2RlbWFzaysweGI3LzB4OTQwDQpbICAgIDAuMzQ4NzA2XSBQR0QgMCANClsgICAgMC4zNTA3MzVd
IE9vcHM6IDAwMDAgWyMxXSBTTVAgDQpbICAgIDAuMzUzOTkzXSBNb2R1bGVzIGxpbmtlZCBpbjoN
ClsgICAgMC4zNTcwNjNdIENQVTogMCBQSUQ6IDEgQ29tbTogc3dhcHBlci8wIE5vdCB0YWludGVk
IDQuMC4wLXJjNCAjMQ0KWyAgICAwLjM2MzIzMl0gSGFyZHdhcmUgbmFtZTogSW5zcHVyIFRTODYw
L1RTODYwLCBCSU9TIFRTODYwXzIuMC4wIDIwMTUvMDMvMjQNClsgICAgMC4zNzAwOTVdIHRhc2s6
IGZmZmY4ODA4NWIxZTAwMDAgdGk6IGZmZmY4ODA4NWIxZTgwMDAgdGFzay50aTogZmZmZjg4MDg1
YjFlODAwMA0KWyAgICAwLjM3NzU2NF0gUklQOiAwMDEwOls8ZmZmZmZmZmY4MTE4MjU4Nz5dICBb
PGZmZmZmZmZmODExODI1ODc+XSBfX2FsbG9jX3BhZ2VzX25vZGVtYXNrKzB4YjcvMHg5NDANClsg
ICAgMC4zODY1MjRdIFJTUDogMDAwMDpmZmZmODgwODViMWViYWM4ICBFRkxBR1M6IDAwMDEwMjQ2
DQpbICAgIDAuMzkxODI4XSBSQVg6IDAwMDAwMDAwMDAwMDFiMDAgUkJYOiAwMDAwMDAwMDAwMDAw
MDEwIFJDWDogMDAwMDAwMDAwMDAwMDAwMA0KWyAgICAwLjM5ODk1M10gUkRYOiAwMDAwMDAwMDAw
MDAwMDAwIFJTSTogMDAwMDAwMDAwMDAwMDAwMCBSREk6IDAwMDAwMDAwMDAyMDUyZDANClsgICAg
MC40MDYwNzVdIFJCUDogZmZmZjg4MDg1YjFlYmJiOCBSMDg6IGZmZmY4ODA4NWIxM2ZlYzAgUjA5
OiAwMDAwMDAwMDViMTNmZTAxDQpbICAgIDAuNDEzMTk4XSBSMTA6IGZmZmY4ODA4NWU4MDczMDAg
UjExOiBmZmZmZmZmZjgxMGQ0YmMxIFIxMjogMDAwMDAwMDAwMDAxMDAyYQ0KWyAgICAwLjQyMDMy
MV0gUjEzOiAwMDAwMDAwMDAwMjA1MmQwIFIxNDogMDAwMDAwMDAwMDAwMDAwMSBSMTU6IDAwMDAw
MDAwMDAwMDQwZDANClsgICAgMC40Mjc0NDZdIEZTOiAgMDAwMDAwMDAwMDAwMDAwMCgwMDAwKSBH
UzpmZmZmODgwODVlZTAwMDAwKDAwMDApIGtubEdTOjAwMDAwMDAwMDAwMDAwMDANClsgICAgMC40
MzU1MjJdIENTOiAgMDAxMCBEUzogMDAwMCBFUzogMDAwMCBDUjA6IDAwMDAwMDAwODAwNTAwMzMN
ClsgICAgMC40NDEyNTldIENSMjogMDAwMDAwMDAwMDAwMWIwOCBDUjM6IDAwMDAwMDAwMDE5YWUw
MDAgQ1I0OiAwMDAwMDAwMDAwMTQwNmYwDQpbICAgIDAuNDQ4MzgyXSBTdGFjazoNClsgICAgMC40
NTAzOTJdICBmZmZmODgwODViMWUwMDAwIDAwMDAwMDAwMDAwMDA0MDAgZmZmZjg4MDg1YjFlZmZm
ZiBmZmZmODgwODViMWViYjY4DQpbICAgIDAuNDU3ODQ2XSAgMDAwMDAwMDAwMDAwMDA3YiBmZmZm
ODgwODViMTJkMTQwIGZmZmY4ODA4NWIyNDkwMDAgMDAwMDAwMDAwMDAwMDA3Yg0KWyAgICAwLjQ2
NTI5OF0gIGZmZmY4ODA4NWIxZWJiMjggZmZmZmZmZmY4MWFmMjkwMCAwMDAwMDAwMDAwMDAwMDAw
IDAwMjA1MmQwNWIxMmQxNDANClsgICAgMC40NzI3NTBdIENhbGwgVHJhY2U6DQpbICAgIDAuNDc1
MjA2XSAgWzxmZmZmZmZmZjgxMWQyN2IzPl0gPyBkZWFjdGl2YXRlX3NsYWIrMHgzODMvMHg0MDAN
ClsgICAgMC40ODExMjNdICBbPGZmZmZmZmZmODExZDM5NDc+XSBuZXdfc2xhYisweGE3LzB4NDYw
DQpbICAgIDAuNDg2MTc0XSAgWzxmZmZmZmZmZjgxNjc4OWU1Pl0gX19zbGFiX2FsbG9jKzB4MzEw
LzB4NDcwDQpbICAgIDAuNDkxNjU1XSAgWzxmZmZmZmZmZjgxMDUzMDRmPl0gPyBkbWFyX21zaV9z
ZXRfYWZmaW5pdHkrMHg4Zi8weGMwDQpbICAgIDAuNDk3OTIxXSAgWzxmZmZmZmZmZjgxMGQ0YmMx
Pl0gPyBfX2lycV9kb21haW5fYWRkKzB4NDEvMHgxMDANClsgICAgMC41MDM4MzhdICBbPGZmZmZm
ZmZmODEwZDBmZWU+XSA/IGlycV9kb19zZXRfYWZmaW5pdHkrMHg1ZS8weDcwDQpbICAgIDAuNTA5
OTIwXSAgWzxmZmZmZmZmZjgxMWQ1NzFkPl0gX19rbWFsbG9jX25vZGUrMHhhZC8weDJlMA0KWyAg
ICAwLjUxNTQ4M10gIFs8ZmZmZmZmZmY4MTBkNGJjMT5dID8gX19pcnFfZG9tYWluX2FkZCsweDQx
LzB4MTAwDQpbICAgIDAuNTIxMzkyXSAgWzxmZmZmZmZmZjgxMGQ0YmMxPl0gX19pcnFfZG9tYWlu
X2FkZCsweDQxLzB4MTAwDQpbICAgIDAuNTI3MTMzXSAgWzxmZmZmZmZmZjgxMDUxMDJlPl0gbXBf
aXJxZG9tYWluX2NyZWF0ZSsweDllLzB4MTIwDQpbICAgIDAuNTMzMTQwXSAgWzxmZmZmZmZmZjgx
YjJmYjE0Pl0gc2V0dXBfSU9fQVBJQysweDY0LzB4MWJlDQpbICAgIDAuNTM4NjIyXSAgWzxmZmZm
ZmZmZjgxYjJlMjI2Pl0gYXBpY19ic3Bfc2V0dXArMHhhMi8weGFlDQpbICAgIDAuNTQ0MDk5XSAg
WzxmZmZmZmZmZjgxYjJiYzcwPl0gbmF0aXZlX3NtcF9wcmVwYXJlX2NwdXMrMHgyNjcvMHgyYjIN
ClsgICAgMC41NTA1MzFdICBbPGZmZmZmZmZmODFiMTkyN2I+XSBrZXJuZWxfaW5pdF9mcmVlYWJs
ZSsweGYyLzB4MjUzDQpbICAgIDAuNTU2NjI1XSAgWzxmZmZmZmZmZjgxNjZiOTYwPl0gPyByZXN0
X2luaXQrMHg4MC8weDgwDQpbICAgIDAuNTYxODQ1XSAgWzxmZmZmZmZmZjgxNjZiOTZlPl0ga2Vy
bmVsX2luaXQrMHhlLzB4ZjANClsgICAgMC41NjY5NzldICBbPGZmZmZmZmZmODE2ODFiZDg+XSBy
ZXRfZnJvbV9mb3JrKzB4NTgvMHg5MA0KWyAgICAwLjU3MjM3NF0gIFs8ZmZmZmZmZmY4MTY2Yjk2
MD5dID8gcmVzdF9pbml0KzB4ODAvMHg4MA0KWyAgICAwLjU3NzU5MV0gQ29kZTogMzAgOTcgMDAg
ODkgNDUgYmMgODMgZTEgMGYgYjggMjIgMDEgMzIgMDEgMDEgYzkgZDMgZjggODMgZTAgMDMgODkg
OWQgNmMgZmYgZmYgZmYgODMgZTMgMTAgODkgNDUgYzAgMGYgODUgNmQgMDEgMDAgMDAgNDggOGIg
NDUgODggPDQ4PiA4MyA3OCAwOCAwMCAwZiA4NCA1MSAwMSAwMCAwMCBiOCAwMSAwMCAwMCAwMCA0
NCA4OSBmMSBkMyBlMCANClsgICAgMC41OTc1MzddIFJJUCAgWzxmZmZmZmZmZjgxMTgyNTg3Pl0g
X19hbGxvY19wYWdlc19ub2RlbWFzaysweGI3LzB4OTQwDQpbICAgIDAuNjA0MTU4XSAgUlNQIDxm
ZmZmODgwODViMWViYWM4Pg0KWyAgICAwLjYwNzY0M10gQ1IyOiAwMDAwMDAwMDAwMDAxYjA4DQpb
ICAgIDAuNjEwOTYyXSAtLS1bIGVuZCB0cmFjZSAwYTYwMGMwODQxMzg2OTkyIF0tLS0NClsgICAg
MC42MTU1NzNdIEtlcm5lbCBwYW5pYyAtIG5vdCBzeW5jaW5nOiBGYXRhbCBleGNlcHRpb24NClsg
ICAgMC42MjA3OTJdIC0tLVsgZW5kIEtlcm5lbCBwYW5pYyAtIG5vdCBzeW5jaW5nOiBGYXRhbCBl
eGNlcHRpb24NCg0KDQoNCg0KRnJvbTogUm9iIEhlcnJpbmcNCkRhdGU6IDIwMTUtMDQtMTQgMDA6
NDkNClRvOiBLb25zdGFudGluIEtobGVibmlrb3YNCkNDOiBHcmFudCBMaWtlbHk7IGRldmljZXRy
ZWVAdmdlci5rZXJuZWwub3JnOyBSb2IgSGVycmluZzsgbGludXgta2VybmVsQHZnZXIua2VybmVs
Lm9yZzsgc3BhcmNsaW51eEB2Z2VyLmtlcm5lbC5vcmc7IGxpbnV4LW1tQGt2YWNrLm9yZzsgbGlu
dXhwcGMtZGV2DQpTdWJqZWN0OiBSZTogW1BBVENIXSBvZjogcmV0dXJuIE5VTUFfTk9fTk9ERSBm
cm9tIGZhbGxiYWNrIG9mX25vZGVfdG9fbmlkKCkNCk9uIE1vbiwgQXByIDEzLCAyMDE1IGF0IDg6
MzggQU0sIEtvbnN0YW50aW4gS2hsZWJuaWtvdg0KPGtobGVibmlrb3ZAeWFuZGV4LXRlYW0ucnU+
IHdyb3RlOg0KPiBPbiAxMy4wNC4yMDE1IDE2OjIyLCBSb2IgSGVycmluZyB3cm90ZToNCj4+DQo+
PiBPbiBXZWQsIEFwciA4LCAyMDE1IGF0IDExOjU5IEFNLCBLb25zdGFudGluIEtobGVibmlrb3YN
Cj4+IDxraGxlYm5pa292QHlhbmRleC10ZWFtLnJ1PiB3cm90ZToNCj4+Pg0KPj4+IE5vZGUgMCBt
aWdodCBiZSBvZmZsaW5lIGFzIHdlbGwgYXMgYW55IG90aGVyIG51bWEgbm9kZSwNCj4+PiBpbiB0
aGlzIGNhc2Uga2VybmVsIGNhbm5vdCBoYW5kbGUgbWVtb3J5IGFsbG9jYXRpb24gYW5kIGNyYXNo
ZXMuDQo+Pj4NCj4+PiBTaWduZWQtb2ZmLWJ5OiBLb25zdGFudGluIEtobGVibmlrb3YgPGtobGVi
bmlrb3ZAeWFuZGV4LXRlYW0ucnU+DQo+Pj4gRml4ZXM6IDBjM2YwNjFjMTk1YyAoIm9mOiBpbXBs
ZW1lbnQgb2Zfbm9kZV90b19uaWQgYXMgYSB3ZWFrIGZ1bmN0aW9uIikNCj4+PiAtLS0NCj4+PiAg
IGRyaXZlcnMvb2YvYmFzZS5jICB8ICAgIDIgKy0NCj4+PiAgIGluY2x1ZGUvbGludXgvb2YuaCB8
ICAgIDUgKysrKy0NCj4+PiAgIDIgZmlsZXMgY2hhbmdlZCwgNSBpbnNlcnRpb25zKCspLCAyIGRl
bGV0aW9ucygtKQ0KPj4+DQo+Pj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvb2YvYmFzZS5jIGIvZHJp
dmVycy9vZi9iYXNlLmMNCj4+PiBpbmRleCA4ZjE2NWIxMTJlMDMuLjUxZjRiZDE2ZTYxMyAxMDA2
NDQNCj4+PiAtLS0gYS9kcml2ZXJzL29mL2Jhc2UuYw0KPj4+ICsrKyBiL2RyaXZlcnMvb2YvYmFz
ZS5jDQo+Pj4gQEAgLTg5LDcgKzg5LDcgQEAgRVhQT1JUX1NZTUJPTChvZl9uX3NpemVfY2VsbHMp
Ow0KPj4+ICAgI2lmZGVmIENPTkZJR19OVU1BDQo+Pj4gICBpbnQgX193ZWFrIG9mX25vZGVfdG9f
bmlkKHN0cnVjdCBkZXZpY2Vfbm9kZSAqbnApDQo+Pj4gICB7DQo+Pj4gLSAgICAgICByZXR1cm4g
bnVtYV9ub2RlX2lkKCk7DQo+Pj4gKyAgICAgICByZXR1cm4gTlVNQV9OT19OT0RFOw0KPj4NCj4+
DQo+PiBUaGlzIGlzIGdvaW5nIHRvIGJyZWFrIGFueSBOVU1BIG1hY2hpbmUgdGhhdCBlbmFibGVz
IE9GIGFuZCBleHBlY3RzDQo+PiB0aGUgd2VhayBmdW5jdGlvbiB0byB3b3JrLg0KPg0KPg0KPiBX
aHk/IE5VTUFfTk9fTk9ERSA9PSAtMSAtLSB0aGlzJ3Mgc3RhbmRhcmQgIm5vLWFmZmluaXR5IiBz
aWduYWwuDQo+IEFzIEkgc2VlIHBvd2VycGMvc3BhcmMgdmVyc2lvbnMgb2Ygb2Zfbm9kZV90b19u
aWQgcmV0dXJucyAtMSBpZiB0aGV5DQo+IGNhbm5vdCBmaW5kIG91dCB3aGljaCBub2RlIHNob3Vs
ZCBiZSB1c2VkLg0KDQpBaCwgSSB3YXMgdGhpbmtpbmcgdGhvc2UgcGxhdGZvcm1zIHdlcmUgcmVs
eWluZyBvbiB0aGUgZGVmYXVsdA0KaW1wbGVtZW50YXRpb24uIEkgZ3Vlc3MgYW55IHJlYWwgTlVN
QSBzdXBwb3J0IGlzIGdvaW5nIHRvIG5lZWQgdG8NCm92ZXJyaWRlIHRoaXMgZnVuY3Rpb24uIFRo
ZSBhcm02NCBwYXRjaCBzZXJpZXMgZG9lcyB0aGF0IGFzIHdlbGwuIFdlDQpuZWVkIHRvIGJlIHN1
cmUgdGhpcyBjaGFuZ2UgaXMgY29ycmVjdCBmb3IgbWV0YWcgd2hpY2ggYXBwZWFycyB0byBiZQ0K
dGhlIG9ubHkgb3RoZXIgT0YgZW5hYmxlZCBwbGF0Zm9ybSB3aXRoIE5VTUEgc3VwcG9ydC4NCg0K
SW4gdGhhdCBjYXNlLCB0aGVuIHRoZXJlIGlzIGxpdHRsZSByZWFzb24gdG8ga2VlcCB0aGUgaW5s
aW5lIGFuZCB3ZQ0KY2FuIGp1c3QgYWx3YXlzIGVuYWJsZSB0aGUgd2VhayBmdW5jdGlvbiAod2l0
aCB5b3VyIGNoYW5nZSkuIEl0IGlzDQpzbGlnaHRseSBsZXNzIG9wdGltYWwsIGJ1dCB0aGUgZmV3
IGNhbGxlcnMgaGFyZGx5IGFwcGVhciB0byBiZSBob3QNCnBhdGhzLg0KDQpSb2INCi0tDQpUbyB1
bnN1YnNjcmliZSBmcm9tIHRoaXMgbGlzdDogc2VuZCB0aGUgbGluZSAidW5zdWJzY3JpYmUgbGlu
dXgta2VybmVsIiBpbg0KdGhlIGJvZHkgb2YgYSBtZXNzYWdlIHRvIG1ham9yZG9tb0B2Z2VyLmtl
cm5lbC5vcmcNCk1vcmUgbWFqb3Jkb21vIGluZm8gYXQgIGh0dHA6Ly92Z2VyLmtlcm5lbC5vcmcv
bWFqb3Jkb21vLWluZm8uaHRtbA0KUGxlYXNlIHJlYWQgdGhlIEZBUSBhdCAgaHR0cDovL3d3dy50
dXgub3JnL2xrbWwv

------=_001_NextPart033685720058_=----
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

=EF=BB=BF<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META content=3D"text/html; charset=3Dutf-8" http-equiv=3DContent-Type>
<STYLE>
BLOCKQUOTE {
	MARGIN-TOP: 0px; MARGIN-BOTTOM: 0px; MARGIN-LEFT: 2em
}
OL {
	MARGIN-TOP: 0px; MARGIN-BOTTOM: 0px
}
UL {
	MARGIN-TOP: 0px; MARGIN-BOTTOM: 0px
}
P {
	MARGIN-TOP: 0px; MARGIN-BOTTOM: 0px
}
BODY {
	LINE-HEIGHT: 1.5; FONT-FAMILY: =E5=BE=AE=E8=BD=AF=E9=9B=85=E9=BB=91; COLO=
R: #000000; FONT-SIZE: 10.5pt
}
</STYLE>

<META name=3DGENERATOR content=3D"MSHTML 9.00.8112.16545"></HEAD>
<BODY style=3D"MARGIN: 10px">
<DIV>
<DIV>
<DIV>
<DIV>When we test the cpu and memory hotplug feature in the server with x8=
6=20
architecture and kernel4.0-rc4,we met the similar problem.<BR><BR></DIV>
<DIV></DIV>
<DIV>The situation is that when memory in node0 is offline,the system is d=
own=20
during booting.</DIV></DIV>
<DIV><BR>Following is the bug information:<BR>
<DIV>[&nbsp;&nbsp;&nbsp; 0.335176] BUG: unable to handle kernel paging req=
uest=20
at 0000000000001b08<BR>[&nbsp;&nbsp;&nbsp; 0.342164] IP:=20
[&lt;ffffffff81182587&gt;]=20
__alloc_pages_nodemask+0xb7/0x940<BR>[&nbsp;&nbsp;&nbsp; 0.348706] PGD 0=20
<BR>[&nbsp;&nbsp;&nbsp; 0.350735] Oops: 0000 [#1] SMP <BR>[&nbsp;&nbsp;&nb=
sp;=20
0.353993] Modules linked in:<BR>[&nbsp;&nbsp;&nbsp; 0.357063] CPU: 0 PID: =
1=20
Comm: swapper/0 Not tainted 4.0.0-rc4 #1<BR>[&nbsp;&nbsp;&nbsp; 0.363232]=20
Hardware name: Inspur TS860/TS860, BIOS TS860_2.0.0=20
2015/03/24<BR>[&nbsp;&nbsp;&nbsp; 0.370095] task: ffff88085b1e0000 ti:=20
ffff88085b1e8000 task.ti: ffff88085b1e8000<BR>[&nbsp;&nbsp;&nbsp; 0.377564=
] RIP:=20
0010:[&lt;ffffffff81182587&gt;]&nbsp; [&lt;ffffffff81182587&gt;]=20
__alloc_pages_nodemask+0xb7/0x940<BR>[&nbsp;&nbsp;&nbsp; 0.386524] RSP:=20
0000:ffff88085b1ebac8&nbsp; EFLAGS: 00010246<BR>[&nbsp;&nbsp;&nbsp; 0.3918=
28]=20
RAX: 0000000000001b00 RBX: 0000000000000010 RCX:=20
0000000000000000<BR>[&nbsp;&nbsp;&nbsp; 0.398953] RDX: 0000000000000000 RS=
I:=20
0000000000000000 RDI: 00000000002052d0<BR>[&nbsp;&nbsp;&nbsp; 0.406075] RB=
P:=20
ffff88085b1ebbb8 R08: ffff88085b13fec0 R09:=20
000000005b13fe01<BR>[&nbsp;&nbsp;&nbsp; 0.413198] R10: ffff88085e807300 R1=
1:=20
ffffffff810d4bc1 R12: 000000000001002a<BR>[&nbsp;&nbsp;&nbsp; 0.420321] R1=
3:=20
00000000002052d0 R14: 0000000000000001 R15:=20
00000000000040d0<BR>[&nbsp;&nbsp;&nbsp; 0.427446] FS:&nbsp;=20
0000000000000000(0000) GS:ffff88085ee00000(0000)=20
knlGS:0000000000000000<BR>[&nbsp;&nbsp;&nbsp; 0.435522] CS:&nbsp; 0010 DS:=
 0000=20
ES: 0000 CR0: 0000000080050033<BR>[&nbsp;&nbsp;&nbsp; 0.441259] CR2:=20
0000000000001b08 CR3: 00000000019ae000 CR4:=20
00000000001406f0<BR>[&nbsp;&nbsp;&nbsp; 0.448382] Stack:<BR>[&nbsp;&nbsp;&=
nbsp;=20
0.450392]&nbsp; ffff88085b1e0000 0000000000000400 ffff88085b1effff=20
ffff88085b1ebb68<BR>[&nbsp;&nbsp;&nbsp; 0.457846]&nbsp; 000000000000007b=20
ffff88085b12d140 ffff88085b249000 000000000000007b<BR>[&nbsp;&nbsp;&nbsp;=20
0.465298]&nbsp; ffff88085b1ebb28 ffffffff81af2900 0000000000000000=20
002052d05b12d140<BR>[&nbsp;&nbsp;&nbsp; 0.472750] Call=20
Trace:<BR>[&nbsp;&nbsp;&nbsp; 0.475206]&nbsp; [&lt;ffffffff811d27b3&gt;] ?=
=20
deactivate_slab+0x383/0x400<BR>[&nbsp;&nbsp;&nbsp; 0.481123]&nbsp;=20
[&lt;ffffffff811d3947&gt;] new_slab+0xa7/0x460<BR>[&nbsp;&nbsp;&nbsp;=20
0.486174]&nbsp; [&lt;ffffffff816789e5&gt;]=20
__slab_alloc+0x310/0x470<BR>[&nbsp;&nbsp;&nbsp; 0.491655]&nbsp;=20
[&lt;ffffffff8105304f&gt;] ?=20
dmar_msi_set_affinity+0x8f/0xc0<BR>[&nbsp;&nbsp;&nbsp; 0.497921]&nbsp;=20
[&lt;ffffffff810d4bc1&gt;] ? __irq_domain_add+0x41/0x100<BR>[&nbsp;&nbsp;&=
nbsp;=20
0.503838]&nbsp; [&lt;ffffffff810d0fee&gt;] ?=20
irq_do_set_affinity+0x5e/0x70<BR>[&nbsp;&nbsp;&nbsp; 0.509920]&nbsp;=20
[&lt;ffffffff811d571d&gt;] __kmalloc_node+0xad/0x2e0<BR>[&nbsp;&nbsp;&nbsp=
;=20
0.515483]&nbsp; [&lt;ffffffff810d4bc1&gt;] ?=20
__irq_domain_add+0x41/0x100<BR>[&nbsp;&nbsp;&nbsp; 0.521392]&nbsp;=20
[&lt;ffffffff810d4bc1&gt;] __irq_domain_add+0x41/0x100<BR>[&nbsp;&nbsp;&nb=
sp;=20
0.527133]&nbsp; [&lt;ffffffff8105102e&gt;]=20
mp_irqdomain_create+0x9e/0x120<BR>[&nbsp;&nbsp;&nbsp; 0.533140]&nbsp;=20
[&lt;ffffffff81b2fb14&gt;] setup_IO_APIC+0x64/0x1be<BR>[&nbsp;&nbsp;&nbsp;=
=20
0.538622]&nbsp; [&lt;ffffffff81b2e226&gt;]=20
apic_bsp_setup+0xa2/0xae<BR>[&nbsp;&nbsp;&nbsp; 0.544099]&nbsp;=20
[&lt;ffffffff81b2bc70&gt;]=20
native_smp_prepare_cpus+0x267/0x2b2<BR>[&nbsp;&nbsp;&nbsp; 0.550531]&nbsp;=
=20
[&lt;ffffffff81b1927b&gt;]=20
kernel_init_freeable+0xf2/0x253<BR>[&nbsp;&nbsp;&nbsp; 0.556625]&nbsp;=20
[&lt;ffffffff8166b960&gt;] ? rest_init+0x80/0x80<BR>[&nbsp;&nbsp;&nbsp;=20
0.561845]&nbsp; [&lt;ffffffff8166b96e&gt;]=20
kernel_init+0xe/0xf0<BR>[&nbsp;&nbsp;&nbsp; 0.566979]&nbsp;=20
[&lt;ffffffff81681bd8&gt;] ret_from_fork+0x58/0x90<BR>[&nbsp;&nbsp;&nbsp;=20
0.572374]&nbsp; [&lt;ffffffff8166b960&gt;] ?=20
rest_init+0x80/0x80<BR>[&nbsp;&nbsp;&nbsp; 0.577591] Code: 30 97 00 89 45 =
bc 83=20
e1 0f b8 22 01 32 01 01 c9 d3 f8 83 e0 03 89 9d 6c ff ff ff 83 e3 10 89 45=
 c0 0f=20
85 6d 01 00 00 48 8b 45 88 &lt;48&gt; 83 78 08 00 0f 84 51 01 00 00 b8 01 =
00 00=20
00 44 89 f1 d3 e0 <BR>[&nbsp;&nbsp;&nbsp; 0.597537] RIP&nbsp;=20
[&lt;ffffffff81182587&gt;]=20
__alloc_pages_nodemask+0xb7/0x940<BR>[&nbsp;&nbsp;&nbsp; 0.604158]&nbsp; R=
SP=20
&lt;ffff88085b1ebac8&gt;<BR>[&nbsp;&nbsp;&nbsp; 0.607643] CR2:=20
0000000000001b08<BR>[&nbsp;&nbsp;&nbsp; 0.610962] ---[ end trace=20
0a600c0841386992 ]---<BR>[&nbsp;&nbsp;&nbsp; 0.615573] Kernel panic - not=20
syncing: Fatal exception<BR>[&nbsp;&nbsp;&nbsp; 0.620792] ---[ end Kernel =
panic=20
- not syncing: Fatal exception<BR></DIV></DIV></DIV></DIV>
<BLOCKQUOTE cite=3Dmid:2015042818254949058834@inspur.com type=3D"cite">
  <DIV></DIV></BLOCKQUOTE>
<BLOCKQUOTE cite=3Dmid:2015042818254949058834@inspur.com type=3D"cite">
  <DIV>
  <DIV>&nbsp;</DIV></DIV></BLOCKQUOTE>
<DIV>&nbsp;</DIV>
<DIV>&nbsp;</DIV>
<DIV=20
style=3D"BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; PADDING-BOT=
TOM: 0cm; PADDING-LEFT: 0cm; PADDING-RIGHT: 0cm; BORDER-TOP: #b5c4df 1pt s=
olid; BORDER-RIGHT: medium none; PADDING-TOP: 3pt">
<DIV=20
style=3D"PADDING-BOTTOM: 8px; PADDING-LEFT: 8px; PADDING-RIGHT: 8px; FONT-=
FAMILY: tahoma; BACKGROUND: #efefef; COLOR: #000000; FONT-SIZE: 12px; PADD=
ING-TOP: 8px">
<DIV><B>From:</B>&nbsp;<A href=3D"mailto:robherring2@gmail.com">Rob=20
Herring</A></DIV>
<DIV><B>Date:</B>&nbsp;2015-04-14&nbsp;00:49</DIV>
<DIV><B>To:</B>&nbsp;<A href=3D"mailto:khlebnikov@yandex-team.ru">Konstant=
in=20
Khlebnikov</A></DIV>
<DIV><B>CC:</B>&nbsp;<A href=3D"mailto:grant.likely@linaro.org">Grant Like=
ly</A>;=20
<A href=3D"mailto:devicetree@vger.kernel.org">devicetree@vger.kernel.org</=
A>; <A=20
href=3D"mailto:robh+dt@kernel.org">Rob Herring</A>; <A=20
href=3D"mailto:linux-kernel@vger.kernel.org">linux-kernel@vger.kernel.org<=
/A>; <A=20
href=3D"mailto:sparclinux@vger.kernel.org">sparclinux@vger.kernel.org</A>;=
 <A=20
href=3D"mailto:linux-mm@kvack.org">linux-mm@kvack.org</A>; <A=20
href=3D"mailto:linuxppc-dev@lists.ozlabs.org">linuxppc-dev</A></DIV>
<DIV><B>Subject:</B>&nbsp;Re: [PATCH] of: return NUMA_NO_NODE from fallbac=
k=20
of_node_to_nid()</DIV></DIV></DIV>
<DIV>
<DIV>On Mon, Apr 13, 2015 at 8:38 AM, Konstantin Khlebnikov</DIV>
<DIV>&lt;khlebnikov@yandex-team.ru&gt; wrote:</DIV>
<DIV>&gt; On 13.04.2015 16:22, Rob Herring wrote:</DIV>
<DIV>&gt;&gt;</DIV>
<DIV>&gt;&gt; On Wed, Apr 8, 2015 at 11:59 AM, Konstantin Khlebnikov</DIV>
<DIV>&gt;&gt; &lt;khlebnikov@yandex-team.ru&gt; wrote:</DIV>
<DIV>&gt;&gt;&gt;</DIV>
<DIV>&gt;&gt;&gt; Node 0 might be offline as well as any other numa node,<=
/DIV>
<DIV>&gt;&gt;&gt; in this case kernel cannot handle memory allocation and=20
crashes.</DIV>
<DIV>&gt;&gt;&gt;</DIV>
<DIV>&gt;&gt;&gt; Signed-off-by: Konstantin Khlebnikov=20
&lt;khlebnikov@yandex-team.ru&gt;</DIV>
<DIV>&gt;&gt;&gt; Fixes: 0c3f061c195c ("of: implement of_node_to_nid as a =
weak=20
function")</DIV>
<DIV>&gt;&gt;&gt; ---</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; drivers/of/base.c&nbsp; |&nbsp;&nbsp;&nbsp; =
2=20
+-</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; include/linux/of.h |&nbsp;&nbsp;&nbsp; 5=20
++++-</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; 2 files changed, 5 insertions(+), 2=20
deletions(-)</DIV>
<DIV>&gt;&gt;&gt;</DIV>
<DIV>&gt;&gt;&gt; diff --git a/drivers/of/base.c b/drivers/of/base.c</DIV>
<DIV>&gt;&gt;&gt; index 8f165b112e03..51f4bd16e613 100644</DIV>
<DIV>&gt;&gt;&gt; --- a/drivers/of/base.c</DIV>
<DIV>&gt;&gt;&gt; +++ b/drivers/of/base.c</DIV>
<DIV>&gt;&gt;&gt; @@ -89,7 +89,7 @@ EXPORT_SYMBOL(of_n_size_cells);</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; #ifdef CONFIG_NUMA</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; int __weak of_node_to_nid(struct device_node=
=20
*np)</DIV>
<DIV>&gt;&gt;&gt;&nbsp;&nbsp; {</DIV>
<DIV>&gt;&gt;&gt; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return=20
numa_node_id();</DIV>
<DIV>&gt;&gt;&gt; +&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return=20
NUMA_NO_NODE;</DIV>
<DIV>&gt;&gt;</DIV>
<DIV>&gt;&gt;</DIV>
<DIV>&gt;&gt; This is going to break any NUMA machine that enables OF and=20
expects</DIV>
<DIV>&gt;&gt; the weak function to work.</DIV>
<DIV>&gt;</DIV>
<DIV>&gt;</DIV>
<DIV>&gt; Why? NUMA_NO_NODE =3D=3D -1 -- this's standard "no-affinity" sig=
nal.</DIV>
<DIV>&gt; As I see powerpc/sparc versions of of_node_to_nid returns -1 if=20
they</DIV>
<DIV>&gt; cannot find out which node should be used.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Ah, I was thinking those platforms were relying on the default</DIV>
<DIV>implementation. I guess any real NUMA support is going to need to</DI=
V>
<DIV>override this function. The arm64 patch series does that as well. We<=
/DIV>
<DIV>need to be sure this change is correct for metag which appears to be<=
/DIV>
<DIV>the only other OF enabled platform with NUMA support.</DIV>
<DIV>&nbsp;</DIV>
<DIV>In that case, then there is little reason to keep the inline and we</=
DIV>
<DIV>can just always enable the weak function (with your change). It is</D=
IV>
<DIV>slightly less optimal, but the few callers hardly appear to be hot</D=
IV>
<DIV>paths.</DIV>
<DIV>&nbsp;</DIV>
<DIV>Rob</DIV>
<DIV>--</DIV>
<DIV>To unsubscribe from this list: send the line "unsubscribe linux-kerne=
l"=20
in</DIV>
<DIV>the body of a message to majordomo@vger.kernel.org</DIV>
<DIV>More majordomo info at&nbsp;=20
http://vger.kernel.org/majordomo-info.html</DIV>
<DIV>Please read the FAQ at&nbsp; http://www.tux.org/lkml/</DIV>
<DIV>&nbsp;</DIV></DIV></BODY></HTML>

------=_001_NextPart033685720058_=------

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
