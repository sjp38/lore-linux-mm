Return-Path: <owner-linux-mm@kvack.org>
Received: from mail6.bemta12.messagelabs.com (mail6.bemta12.messagelabs.com [216.82.250.247])
	by kanga.kvack.org (Postfix) with ESMTP id 4DE466B0025
	for <linux-mm@kvack.org>; Fri, 20 May 2011 04:17:09 -0400 (EDT)
Date: Fri, 20 May 2011 10:17:06 +0200
Message-ID: <s5htycp6b25.wl%tiwai@suse.de>
From: Takashi Iwai <tiwai@suse.de>
Subject: Re: mmap() implementation for pci_alloc_consistent() memory?
In-Reply-To: <4DD60F57.8030000@ladisch.de>
References: <BANLkTi==cinS1bZc_ARRbnYT3YD+FQr8gA@mail.gmail.com>
	<20110519145921.GE9854@dumpdata.com>
	<4DD53E2B.2090002@ladisch.de>
	<BANLkTinO1xR4XTN2B325pKCpJ3AjC9YidA@mail.gmail.com>
	<4DD60F57.8030000@ladisch.de>
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Clemens Ladisch <clemens@ladisch.de>
Cc: Leon Woestenberg <leon.woestenberg@gmail.com>, Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>, linux-pci@vger.kernel.org, linux-mm@kvack.org, linux-kernel@vger.kernel.org

At Fri, 20 May 2011 08:51:03 +0200,
Clemens Ladisch wrote:
> 
> Leon Woestenberg wrote:
> > On Thu, May 19, 2011 at 5:58 PM, Clemens Ladisch <clemens@ladisch.de> wrote:
> >>> On Thu, May 19, 2011 at 12:14:40AM +0200, Leon Woestenberg wrote:
> >>> >     vma->vm_page_prot = pgprot_noncached(vma->vm_page_prot);
> >>
> >> So is this an architecture without coherent caches?
> > 
> > My aim is to have an architecture independent driver.
> 
> Please note that most MMU architectures forbid mapping the same memory
> with different attributes, so you must use pgprot_noncached if and only
> if dma_alloc_coherent actually uses it.  Something like the code below.
> 
> And I'm not sure if you have to do some additional cache flushes when
> mapping on some architectures.
> 
> >> Or would you want to use pgprot_dmacoherent, if available?
> > 
> > Hmm, let me check that.
> 
> It's available only on ARM and Unicore32.
> 
> There's also dma_mmap_coherent(), which does exactly what you want if
> your buffer is physically contiguous, but it's ARM only.
> Takashi tried to implement it for other architectures; I don't know
> what came of it.

PPC got this recently (thanks to Ben), but still missing in other
areas.

There was little uncertain issue on MIPS, and it looks difficult to
achieve it on PA-RISC at all.  The development was stuck due to lack
of time since then.


Takashi

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Fight unfair telecom internet charges in Canada: sign http://stopthemeter.ca/
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
