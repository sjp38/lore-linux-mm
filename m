Return-Path: <owner-linux-mm@kvack.org>
Received: from mail202.messagelabs.com (mail202.messagelabs.com [216.82.254.227])
	by kanga.kvack.org (Postfix) with SMTP id 8967E6B004F
	for <linux-mm@kvack.org>; Wed, 24 Jun 2009 05:17:06 -0400 (EDT)
Received: from mlsv6.hitachi.co.jp (unknown [133.144.234.166])
	by mail9.hitachi.co.jp (Postfix) with ESMTP id BDAD237C82
	for <linux-mm@kvack.org>; Wed, 24 Jun 2009 18:17:35 +0900 (JST)
Message-ID: <4A41EF15.2060507@hitachi.com>
Date: Wed, 24 Jun 2009 18:17:09 +0900
From: Hidehiro Kawai <hidehiro.kawai.ez@hitachi.com>
MIME-Version: 1.0
Subject: Re: [PATCH 11/15] HWPOISON: The high level memory error handler in
    the VM v8
References: <20090620031608.624240019@intel.com>
    <20090620031626.106150781@intel.com>
    <20090621085721.GD8218@one.firstfloor.org>
In-Reply-To: <20090621085721.GD8218@one.firstfloor.org>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Sender: owner-linux-mm@kvack.org
To: Andi Kleen <andi@firstfloor.org>
Cc: Wu Fengguang <fengguang.wu@intel.com>, Andrew Morton <akpm@linux-foundation.org>, LKML <linux-kernel@vger.kernel.org>, hugh.dickins@tiscali.co.uk, npiggin@suse.de, chris.mason@oracle.com, Rik van Riel <riel@redhat.com>, Andi Kleen <ak@linux.intel.com>, Ingo Molnar <mingo@elte.hu>, Minchan Kim <minchan.kim@gmail.com>, Mel Gorman <mel@csn.ul.ie>, Thomas Gleixner <tglx@linutronix.de>, "H. Peter Anvin" <hpa@zytor.com>, Peter Zijlstra <a.p.zijlstra@chello.nl>, "linux-mm@kvack.org" <linux-mm@kvack.org>, Satoshi OSHIMA <satoshi.oshima.fk@hitachi.com>
List-ID: <linux-mm.kvack.org>

Andi Kleen wrote:

>>introduce invalidate_inode_page() and don't remove dirty/writeback pages
>>from page cache (Nick, Fengguang)
> 
> I'm still dubious this is a good idea, it means potentially a lot 
> of pages not covered.

I think this is not bad idea for now.
Certainly we become unable to recover from uncorrected memory error
on dirty page cache pages, it will be safer than the old patch.

As for ext3 filesystem, unlike usual I/O error, the I/O error
generated by HWPOISON feature doesn't cause journal abort and
read-only remount even if the fs has been mounted with data=ordered
and data_err=abort options.  So we can re-read the old data and
update the fs after failing to write out dirty data, this may
cause an integrity problem.  And improper data can be exposed
by the re-read if it's a newly allocated data block.

The amount of dirty pages are not so many because it is limited
by dirty_ratio or dirty_bytes.  HWPOISON feature is still
useful even if it doesn't cover dirty page cache pages. :-)

Regards,
-- 
Hidehiro Kawai
Hitachi, Systems Development Laboratory
Linux Technology Center

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
