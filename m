Return-Path: <owner-linux-mm@kvack.org>
Received: from mail-pa0-f46.google.com (mail-pa0-f46.google.com [209.85.220.46])
	by kanga.kvack.org (Postfix) with ESMTP id 6C5706B006E
	for <linux-mm@kvack.org>; Thu,  2 Apr 2015 21:24:25 -0400 (EDT)
Received: by pactp5 with SMTP id tp5so100597016pac.1
        for <linux-mm@kvack.org>; Thu, 02 Apr 2015 18:24:25 -0700 (PDT)
Received: from mail.sfc.wide.ad.jp (shonan.sfc.wide.ad.jp. [203.178.142.130])
        by mx.google.com with ESMTPS id a4si9776452pdn.18.2015.04.02.18.24.23
        for <linux-mm@kvack.org>
        (version=TLSv1.2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Thu, 02 Apr 2015 18:24:24 -0700 (PDT)
Date: Fri, 03 Apr 2015 10:24:21 +0900
Message-ID: <m2y4maqa0q.wl@wide.ad.jp>
From: Hajime Tazaki<tazaki@wide.ad.jp>
Subject: Re: [RFC PATCH 08/11] lib: other kernel glue layer code
In-Reply-To: <m2zj6t7h48.wl@wide.ad.jp>
References: <1427202642-1716-1-git-send-email-tazaki@sfc.wide.ad.jp>
	<1427202642-1716-9-git-send-email-tazaki@sfc.wide.ad.jp>
	<5518419E.8010007@nod.at>
	<m2zj6t7h48.wl@wide.ad.jp>
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: richard@nod.at
Cc: linux-arch@vger.kernel.org, arnd@arndb.de, corbet@lwn.net, cl@linux.com, penberg@kernel.org, rientjes@google.com, iamjoonsoo.kim@lge.com, akpm@linux-foundation.org, linux-kernel@vger.kernel.org, linux-doc@vger.kernel.org, netdev@vger.kernel.org, linux-mm@kvack.org, jdike@addtoit.com, rusty@rustcorp.com.au, mathieu.lacage@gmail.com, christoph.paasch@gmail.com


Hi Richard,

At Tue, 31 Mar 2015 16:36:55 +0900,
Hajime Tazaki wrote:

> now I'm trying to minimize those stubs by reusing the original
> codes (i.e., fs/filesystems.c for register_filesystem()). I
> will let you know once I've done (maybe v2 RFC if you think
> it's better ?)

I've extensively removed about 1K LoC of stubs (glues)
including e.g., register_filesystem(). There are still stubs
need to be tracked, like file mount code, memory management,
but it can be improved later I think.

commit edc9109d6d1a36f691872549762f954783a9a628
Author: Hajime Tazaki <tazaki@sfc.wide.ad.jp>
Date:   Tue Mar 31 22:32:21 2015 +0900

    lib: reduce glue codes (stubs)
    
 arch/lib/Makefile                  |  22 ++--
 arch/lib/capability.c              |  47 +++++++
 arch/lib/cred.c                    |  16 ---
 arch/lib/dcache.c                  |  93 --------------
 arch/lib/filemap.c                 |   5 +
 arch/lib/fs.c                      | 239 ++----------------------------------
 arch/lib/glue.c                    |  75 ++---------
 arch/lib/include/asm/Kbuild        |   2 +
 arch/lib/include/asm/atomic.h      |   5 +-
 arch/lib/include/asm/thread_info.h |   1 +
 arch/lib/inode.c                   | 146 ----------------------
 arch/lib/lib.c                     |   5 +
 arch/lib/proc.c                    | 130 --------------------
 arch/lib/sched.c                   |  41 +++++++
 arch/lib/security.c                |  45 -------
 arch/lib/seq.c                     | 122 ------------------
 arch/lib/slab.c                    |   3 +
 arch/lib/softirq.c                 |   4 +
 arch/lib/splice.c                  |  20 ---
 arch/lib/super.c                   | 210 -------------------------------
 arch/lib/sysctl.c                  |  15 ---
 arch/lib/time.c                    |   5 -
 22 files changed, 142 insertions(+), 1109 deletions(-)

(full modification on this commit)
https://github.com/libos-nuse/net-next-nuse/commit/edc9109d6d1a36f691872549762f954783a9a628

I still have a couple of comments, which I haven't addressed
with the code (below). will work on too.

* build system (Makefile)
- parallel build issue
- cross-build issue
- missing dependency detection

* code location
- under arch/ or tools/

-- Hajime

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
