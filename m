Return-Path: <owner-linux-mm@kvack.org>
Received: from mail-oi0-f51.google.com (mail-oi0-f51.google.com [209.85.218.51])
	by kanga.kvack.org (Postfix) with ESMTP id B51706B0038
	for <linux-mm@kvack.org>; Thu,  9 Jul 2015 02:20:35 -0400 (EDT)
Received: by oibp128 with SMTP id p128so21368863oib.3
        for <linux-mm@kvack.org>; Wed, 08 Jul 2015 23:20:35 -0700 (PDT)
Received: from zte.com.cn (mx7.zte.com.cn. [202.103.147.169])
        by mx.google.com with ESMTP id u132si3401784oiu.128.2015.07.08.23.20.34
        for <linux-mm@kvack.org>;
        Wed, 08 Jul 2015 23:20:34 -0700 (PDT)
MIME-Version: 1.0
Subject: slab:Fix the unexpected index mapping result of kmalloc_size(INDEX_NODE + 1)
Message-ID: <OF591717D2.930C6B40-ON48257E7D.0017016C-48257E7D.0020AFB4@zte.com.cn>
From: liu.hailong6@zte.com.cn
Date: Thu, 9 Jul 2015 13:56:46 +0800
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: base64
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Pekka Enberg <penberg@kernel.org>
Cc: linux-mm@kvack.org, jiang.xuexin@zte.com.cn

RnJvbSBlNzc0OWE5NGQ2M2RhZTIxZmVhYTUzOTUzYzhhZmZlYjIzMDUwZDA0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQ0KRnJvbTogbGl1aGFpbG9uZyA8bGl1LmhhaWxvbmc2QHp0ZS5jb20uY24+
DQpEYXRlOiBUaHUsIDkgSnVsIDIwMTUgMDk6MDI6MjcgKzA4MDANClN1YmplY3Q6IFtQQVRDSF0g
c2xhYjpGaXggdGhlIHVuZXhwZWN0ZWQgaW5kZXggbWFwcGluZyByZXN1bHQgb2YgDQprbWFsbG9j
X3NpemUoSU5ERVhfTk9ERSArIDEpDQoNCktlcm5lbCBhZnRlciB2My45IHVzaW5nIGttYWxsb2Nf
c2l6ZShJTkRFWF9OT0RFICsgMSkgdG8gZ2V0IHRoZSBuZXh0IA0KbGFyZ2VyDQpjYWNoZSBzaXpl
IHRoYW4gdGhlIHNpemUgaW5kZXggSU5ERVhfTk9ERSBtYXBwaW5nLCBpbnN0ZWFkIG9mDQptYWxs
b2Nfc2l6ZXNbSU5ERVhfTDMgKyAxXS5jc19zaXplIHdoaWNoIHJlYWxpemVkIGluIHRoZSBrZXJu
ZWwgMy45Lg0KSG93ZXZlciwgc29tZXRpbWVzIHdlIGNhbid0IGdldCB0aGUgcmlnaHQgb3V0cHV0
IHdlIGV4cGVjdGVkIGJ5DQprbWFsbG9jX3NpemUoSU5ERVhfTk9ERSArIDEpLGFuZCAsdGhpcyBt
YXkgY2F1c2Ugc29tZSBCVUdzLg0KDQpUaGUgbWFwcGluZyB0YWJsZSBpbiBsYXRlc3Qga2VybmVs
IGxpa2VzOg0KICAgIGluZGV4ID0gezAsICAgMSwgIDIgLCAgMywgIDQsICAgNSwgICA2LCAgICAg
bn0NCiAgICAgc2l6ZSA9IHswLCAgIDk2LCAxOTIsIDgsIDE277yMIDMy77yMICA2NO+8jCAyXm59
DQpUaGUgbWFwcGluZyB0YWJsZSBiZWZvcmUgMy4xMCBsaWtlcyB0aGlzOg0KICAgIGluZGV4ID0g
ezAgLCAxICwgMiwgICAzLCAgNCAsICA1ICwgIDYsICAgbn0NCiAgICBzaXplICA9IHszMiwgNjQs
IDk2LCAxMjgsIDE5MiwgMjU2LCA1MTIsIDJeKG4rMyl9DQoNClRoZSBwcm9ibGVtIGRlc2NyaWJl
ZCBhcyBmb2xsb3dpbmcgb24gbXkgbWlwczY0IG1hY2hpbmU6DQogICgxKVdoZW4gY29uZmlndXJl
ZCBERUJVR19TTEFCICYmIERFQlVHX1BBR0VBTExPQyAmJiBERUJVR19MT0NLX0FMTE9DDQomJiBE
RUJVR19TUElOTE9DSywgdGhlIHNpemVvZihzdHJ1Y3Qga21lbV9jYWNoZV9ub2RlKSB3aWxsIGJl
ICIxNTAiLCBhbmQNCnRoZSBtYWNybyBJTkRFWF9OT0RFIHR1cm5zIG91dCB0byBiZSAiMiI6DQoj
ZGVmaW5lIElOREVYX05PREUga21hbGxvY19pbmRleChzaXplb2Yoc3RydWN0IGttZW1fY2FjaGVf
bm9kZSkpDQogICgyKVRoZW4gdGhlIHJlc3VsdCBvZiBrbWFsbG9jX3NpemUoSU5ERVhfTk9ERSAr
IDEpIGlzIDguDQogICgzKVRoZW4gImlmKHNpemUgPj0ga21hbGxvY19zaXplKElOREVYX05PREUg
KyAxKSIgd2lsbCBsZWFkIHRvICJzaXplDQo9IFBBR0VfU0laRSIuDQogICg0KVRoZW4gImlmICgo
c2l6ZSA+PSAoUEFHRV9TSVpFID4+IDMpKSIgdGVzdCB3aWxsIGJlIHNhdGlzZmllZCBhbmQNCiJm
bGFncyB8PSBDRkxHU19PRkZfU0xBQiIgd2lsbCBiZSBjb3ZlcmVkLg0KICAoNSkiaWYgKGZsYWdz
ICYgQ0ZMR1NfT0ZGX1NMQUIpIiB0ZXN0IHdpbGwgYmUgc2F0aXNmaWVkIGFuZCB3aWxsIGdvDQp0
byAiY2FjaGVwLT5zbGFicF9jYWNoZSA9IGttYWxsb2Nfc2xhYihzbGFiX3NpemUsIDB1KSIsIGFu
ZCB0aGUgcmVzdWx0DQpoZXJlIG1heSBiZSBOVUxMIHdoaWxlIGtlcm5lbCBib290dXAuDQogICg2
KUZpbmFsbHksIkJVR19PTihaRVJPX09SX05VTExfUFRSKGNhY2hlcC0+c2xhYnBfY2FjaGUpKTsi
IGNhdXNlIHRoZQ0KQlVHIGluZm8gYXMgdGhlIGZvbGxvd2luZyBzaG93cyhtYXkgYmUgb25seSBt
aXBzNjQgaGFzIHRoaXMgcHJvYmxlbSk6DQoNCiAjMjANCnRhc2s6IGZmZmZmZmZmYzA3MmNkYzAg
dGk6IGZmZmZmZmZmYzA2YjQwMDAgdGFzay50aTogZmZmZmZmZmZjMDZiNDAwMA0KJCAwICAgOiAw
MDAwMDAwMDAwMDAwMDAwIDAwMDAwMDAwMDAwMDAwMTggMDAwMDAwMDAwMDAwMDAwMSANCjAwMDAw
MDAxMDAwMDBmZmYNCiQgNCAgIDogMDAwMDAwMDAwMDAwMDAzMCAwMDAwMDAwMDAwMDAwMDAwIDAw
MDAwMDAwMDAwMDEwMDQgDQowMDAwMDAwMDAwMDAxMDAwDQokIDggICA6IGZmZmZmZmZmODAwMDI4
MDAgMDAwMDAwMDAwMDAwMDAwYiAwMDAwMDAwMDAwMDAwMDAwIA0KMDAwMDAwMDAwMDAwMDAwMA0K
JDEyICAgOiAwMDAwMDAwMDgwMDAwMDAwIDAwMDAwMDAwMDAwMDAwMDAgYzAwMDAwMDBiZjgxOGVi
YyANCmMwMDAwMDAwYmY4MThlYjgNCiQxNiAgIDogYzAwMDAwMDBiZjgxOGVhMCAwMDAwMDAwMDgw
MDAyODAwIDAwMDAwMDAwMDAwMDAwMDAgDQowMDAwMDAwMDAwMDAxMDAwDQokMjAgICA6IDAwMDAw
MDAwMDAwMDAwMzQgMDAwMDAwMDA4MDAwMDAwMCAwMDAwMDAwMDAwMDAwMDAwIA0KMDAwMDAwMDAw
MDAwMDAwNg0KJDI0ICAgOiBmZmZmZmZmZmMxMTYwMDAwIDAwMDAwMDAwMDAwMDAzZjQNCiQyOCAg
IDogZmZmZmZmZmZjMDZiNDAwMCBmZmZmZmZmZmMwNmI3ZDQwIDAwMDAwMDAwMDAwMDIwMDAgDQpm
ZmZmZmZmZmMwMWQwNzdjDQpIaSAgICA6IDAwMDAwMDAwMDAwMDBmZmYNCkxvICAgIDogMDAwMDAw
MDAwMDEwMDAwMA0KZXBjICAgOiBmZmZmZmZmZmMwMWQwNzg0IF9fa21lbV9jYWNoZV9jcmVhdGUr
MHgyYWMvMHg1MzANCiAgICBOb3QgdGFpbnRlZA0KcmEgICAgOiBmZmZmZmZmZmMwMWQwNzdjIF9f
a21lbV9jYWNoZV9jcmVhdGUrMHgyYTQvMHg1MzANClN0YXR1czogMTQxMDAwZTIgICAgICAgIEtY
IFNYIFVYIEtFUk5FTCBFWEwNCkNhdXNlIDogNDA4MDgwMzQNClBySWQgIDogMDAwYzEzMDAgKEJy
b2FkY29tIFhMUElJKQ0KUHJvY2VzcyBzd2FwcGVyIChwaWQ6IDAsIHRocmVhZGluZm89ZmZmZmZm
ZmZjMDZiNDAwMCwgdGFzaz1mZmZmZmZmZmMwNzJjZGMNCiAgICAgICAgMCx0bHM9MDAwMDAwMDAw
MDAwMDAwMCkNCipId1RMUzogZmZmZmZmZmZmYWRlYmVlZg0KU3RhY2sgOiAwMDAwMDAwMGMwNzNi
MDE4IGMwMDAwMDAwYmY4MThlYTAgMDAwMDAwMDAwMDAwMDA0MCANCjAwMDAwMDAwMDAwMDAwMDAN
CiAgICAgICAgZmZmZmZmZmZjMTE1YjM2MCBmZmZmZmZmZmMxMTViMzYwIDAwMDAwMDAwMDAwMDAw
MTcgDQowMDAwMDAwMDAwMDAwMDA3DQogICAgICAgIDAwMDAwMDAwMDAwMDAwMDYgZmZmZmZmZmZj
MDc4MGY1NCAwMDAwMDAwMDAwMDAyMDAwIA0KMDAwMDAwMDAwMDAwMDA0MA0KICAgICAgICBjMDAw
MDAwMGJmODE4ZWEwIDAwMDAwMDAwMDAwMDAwMDAgMDAwMDAwMDAwMDAwMDA0MCANCmZmZmZmZmZm
YzA3ODBmZWMNCiAgICAgICAgMDAwMDAwMDAwMDAwMjAwMCBjMDAwMDAwMGJmODEwZmMwIGZmZmZm
ZmZmYzExNWIzOTAgDQowMDAwMDAwMDAwMDAwMDA2DQogICAgICAgIGZmZmZmZmZmYzExNjAwMDAg
ZmZmZmZmZmZjMDc4MTBiMCAwMDAwMDAwMDAwMDAwMDAxIA0KYzAwMDAwMDBiZjgwOTAwMA0KICAg
ICAgICBmZmZmZmZmZmMwYTMwMDAwIGZmZmZmZmZmYzA3YTAwMDAgZmZmZmZmZmZjMDdhMTc1OCAN
CmZmZmZmZmZmYzBhMzAwMDANCiAgICAgICAgZmZmZmZmZmY4YzE5MDAwMCBmZmZmZmZmZjhiZDAy
OTgzIDAwMDAwMDAwMDAwMDAwMDAgDQpmZmZmZmZmZjhjMThmNzk4DQogICAgICAgIDAwMDAwMDAw
MDAwMDAwMDAgZmZmZmZmZmZjMDc3NDZlMCBmZmZmZmZmZmMwN2ExNzU4IA0KMDAwMDAwMDAwMDAw
MDAwMA0KICAgICAgICAwMDAwMDAwMDAwMDAwMDAwIGZmZmZmZmZmODA1YzU1ODAgMDAwMDAwMDAw
MDAwMDAwMCANCjAwMDAwMDAwMDAwMDAwMDANCiAgICAgICAgICAuLi4NCkNhbGwgVHJhY2U6DQpb
PGZmZmZmZmZmYzAxZDA3ODQ+XSBfX2ttZW1fY2FjaGVfY3JlYXRlKzB4MmFjLzB4NTMwDQpbPGZm
ZmZmZmZmYzA3ODBmNTQ+XSBjcmVhdGVfYm9vdF9jYWNoZSsweDU0LzB4OTANCls8ZmZmZmZmZmZj
MDc4MGZlYz5dIGNyZWF0ZV9rbWFsbG9jX2NhY2hlKzB4NWMvMHg5NA0KWzxmZmZmZmZmZmMwNzgx
MGIwPl0gY3JlYXRlX2ttYWxsb2NfY2FjaGVzKzB4OGMvMHgxYjANCls8ZmZmZmZmZmZjMDc3NDZl
MD5dIHN0YXJ0X2tlcm5lbCsweDFhMC8weDQwOA0KDQpUaGlzIHBhdGNoIGNhbiBmaXggdGhlIHBy
b2JsZW0gb2Yga21hbGxvY19zaXplKElOREVYX05PREUgKyAxKWFuZCB3aWxsDQpyZW1vdmUgdGhl
IEJVRyBhYm92ZSwgSSB0ZXN0IGl0IG9uIG15IG1pcHM2NCBtZWNoaW5lLg0KDQpTaWduZWQtb2Zm
LWJ5OiBMaXVoYWlsb25nIDxsaXUuaGFpbG9uZzZAenRlLmNvbS5jbj4NClJldmlld2VkLWJ5OiBK
aWFueHVleGluIDxqaWFuZy54dWV4aW5AenRlLmNvbS5jbj4NCg0KLS0tDQogbW0vc2xhYi5jIHwg
ICAgMiArLQ0KIDEgZmlsZXMgY2hhbmdlZCwgMSBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9ucygt
KQ0KDQpkaWZmIC0tZ2l0IGEvbW0vc2xhYi5jIGIvbW0vc2xhYi5jDQppbmRleCA2OGI5NWE4Li5m
MWQzM2Q5IDEwMDY0NA0KLS0tIGEvbW0vc2xhYi5jDQorKysgYi9tbS9zbGFiLmMNCkBAIC0yMjA0
LDcgKzIyMDQsNyBAQCBfX2ttZW1fY2FjaGVfY3JlYXRlIChzdHJ1Y3Qga21lbV9jYWNoZSAqY2Fj
aGVwLCANCnVuc2lnbmVkIGxvbmcgZmxhZ3MpDQogICAgICAgICAgICAgICAgICAgICAgICBzaXpl
ICs9IEJZVEVTX1BFUl9XT1JEOw0KICAgICAgICB9DQogI2lmIEZPUkNFRF9ERUJVRyAmJiBkZWZp
bmVkKENPTkZJR19ERUJVR19QQUdFQUxMT0MpDQotICAgICAgIGlmIChzaXplID49IGttYWxsb2Nf
c2l6ZShJTkRFWF9OT0RFICsgMSkNCisgICAgICAgaWYgKHNpemUgPj0ga21hbGxvY19zaXplKElO
REVYX05PREUpKjINCiAgICAgICAgICAgICYmIGNhY2hlcC0+b2JqZWN0X3NpemUgPiBjYWNoZV9s
aW5lX3NpemUoKQ0KICAgICAgICAgICAgJiYgQUxJR04oc2l6ZSwgY2FjaGVwLT5hbGlnbikgPCBQ
QUdFX1NJWkUpIHsNCiAgICAgICAgICAgICAgICBjYWNoZXAtPm9ial9vZmZzZXQgKz0gUEFHRV9T
SVpFIC0gQUxJR04oc2l6ZSwgDQpjYWNoZXAtPmFsaWduKTsNCi0tIA0KMS43LjENCi0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpaVEUgSW5m
b3JtYXRpb24gU2VjdXJpdHkgTm90aWNlOiBUaGUgaW5mb3JtYXRpb24gY29udGFpbmVkIGluIHRo
aXMgbWFpbCAoYW5kIGFueSBhdHRhY2htZW50IHRyYW5zbWl0dGVkIGhlcmV3aXRoKSBpcyBwcml2
aWxlZ2VkIGFuZCBjb25maWRlbnRpYWwgYW5kIGlzIGludGVuZGVkIGZvciB0aGUgZXhjbHVzaXZl
IHVzZSBvZiB0aGUgYWRkcmVzc2VlKHMpLiAgSWYgeW91IGFyZSBub3QgYW4gaW50ZW5kZWQgcmVj
aXBpZW50LCBhbnkgZGlzY2xvc3VyZSwgcmVwcm9kdWN0aW9uLCBkaXN0cmlidXRpb24gb3Igb3Ro
ZXIgZGlzc2VtaW5hdGlvbiBvciB1c2Ugb2YgdGhlIGluZm9ybWF0aW9uIGNvbnRhaW5lZCBpcyBz
dHJpY3RseSBwcm9oaWJpdGVkLiAgSWYgeW91IGhhdmUgcmVjZWl2ZWQgdGhpcyBtYWlsIGluIGVy
cm9yLCBwbGVhc2UgZGVsZXRlIGl0IGFuZCBub3RpZnkgdXMgaW1tZWRpYXRlbHkuDQo=

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
