Return-Path: <owner-linux-mm@kvack.org>
Received: from mail-oi0-f47.google.com (mail-oi0-f47.google.com [209.85.218.47])
	by kanga.kvack.org (Postfix) with ESMTP id 99B4D6B0038
	for <linux-mm@kvack.org>; Wed,  8 Jul 2015 23:36:32 -0400 (EDT)
Received: by oiyy130 with SMTP id y130so180699275oiy.0
        for <linux-mm@kvack.org>; Wed, 08 Jul 2015 20:36:32 -0700 (PDT)
Received: from zte.com.cn (mx7.zte.com.cn. [202.103.147.169])
        by mx.google.com with ESMTP id t2si3492716obs.15.2015.07.08.20.36.30
        for <linux-mm@kvack.org>;
        Wed, 08 Jul 2015 20:36:31 -0700 (PDT)
MIME-Version: 1.0
Subject: slab:Fix the unexpected index mapping result of kmalloc_size(INDEX_NODE + 1)
Message-ID: <OFBE857209.A1B3F378-ON48257E7D.001269A1-48257E7D.0013C0AF@zte.com.cn>
From: liu.hailong6@zte.com.cn
Date: Thu, 9 Jul 2015 11:35:29 +0800
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: base64
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Pekka Enberg <penberg@kernel.org>
Cc: linux-mm@kvack.org, jiang.xuexin@zte.com.cn, huang.jian@zte.com.cn

RnJvbSBlNzc0OWE5NGQ2M2RhZTIxZmVhYTUzOTUzYzhhZmZlYjIzMDUwZDA0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQ0KRnJvbTogbGl1aGFpbG9uZyA8bGl1LmhhaWxvbmc2QHp0ZS5jb20uY24+
DQpEYXRlOiBUaHUsIDkgSnVsIDIwMTUgMDk6MDI6MjcgKzA4MDANClN1YmplY3Q6IFtQQVRDSF0g
c2xhYjpGaXggdGhlIHVuZXhwZWN0ZWQgaW5kZXggbWFwcGluZyByZXN1bHQgb2YgDQprbWFsbG9j
X3NpemUoSU5ERVhfTk9ERSArIDEpDQoNCktlcm5lbCBhZnRlciB2My45IHVzaW5nIGttYWxsb2Nf
c2l6ZShJTkRFWF9OT0RFICsgMSkgdG8gZ2V0IHRoZSBuZXh0IA0KbGFyZ2VyDQpjYWNoZSBzaXpl
IHRoYW4gdGhlIHNpemUgaW5kZXggSU5ERVhfTk9ERSBtYXBwaW5nLCBpbnN0ZWFkIG9mDQptYWxs
b2Nfc2l6ZXNbSU5ERVhfTDMgKyAxXS5jc19zaXplIHdoaWNoIHJlYWxpemVkIGluIHRoZSBrZXJu
ZWwgMy45Lg0KSG93ZXZlciwgc29tZXRpbWVzIHdlIGNhbid0IGdldCB0aGUgcmlnaHQgb3V0cHV0
IHdlIGV4cGVjdGVkIGJ5DQprbWFsbG9jX3NpemUoSU5ERVhfTk9ERSArIDEpLGFuZCAsdGhpcyBt
YXkgY2F1c2Ugc29tZSBCVUdzLg0KDQpUaGUgbWFwcGluZyB0YWJsZSBpbiBsYXRlc3Qga2VybmVs
IGxpa2VzOg0KICAgIGluZGV4ID0gezAsICAgMSwgIDIgLCAgMywgIDQsICAgNSwgICA2LCAgICAg
bn0NCiAgICAgc2l6ZSA9IHswLCAgIDk2LCAxOTIsIDgsIDE277yMIDMy77yMICA2NO+8jCAyXm59
DQpUaGUgbWFwcGluZyB0YWJsZSBiZWZvcmUgMy4xMCBsaWtlcyB0aGlzOg0KICAgIGluZGV4ID0g
ezAgLCAxICwgMiwgICAzLCAgNCAsICA1ICwgIDYsICAgbn0NCiAgICBzaXplICA9IHszMiwgNjQs
IDk2LCAxMjgsIDE5MiwgMjU2LCA1MTIsIDJeKG4rMyl9DQoNClRoZSBwcm9ibGVtIGRpc2NyaWJl
ZCBhcyBmb2xsb3dpbmcgb24gbXkgbWlwczY0IG1hY2hpbmU6DQogICgxKVdoZW4gY29uZmlndXJl
ZCBERUJVR19TTEFCICYmIERFQlVHX1BBR0VBTExPQyAmJiBERUJVR19MT0NLX0FMTE9DDQomJiBE
RUJVR19TUElOTE9DSywgdGhlIHNpemVvZihzdHJ1Y3Qga21lbV9jYWNoZV9ub2RlKSB3aWxsIGJl
ICIxNTAiLCBhbmQNCnRoZSBtYWNybyBJTkRFWF9OT0RFIHR1cm5zIG91dCB0byBiZSAiMiI6DQoj
ZGVmaW5lIElOREVYX05PREUga21hbGxvY19pbmRleChzaXplb2Yoc3RydWN0IGttZW1fY2FjaGVf
bm9kZSkpDQogICgyKVRoZW4gdGhlIHJlc3VsdCBvZiBrbWFsbG9jX3NpemUoSU5ERVhfTk9ERSAr
IDEpIGlzIDguDQogICgzKVRoZW4gImlmKHNpemUgPj0ga21hbGxvY19zaXplKElOREVYX05PREUg
KyAxKSIgd2lsbCBsZWFkIHRvICJzaXplDQo9IFBBR0VfU0laRSIuDQogICg0KVRoZW4gImlmICgo
c2l6ZSA+PSAoUEFHRV9TSVpFID4+IDMpKSIgdGVzdCB3aWxsIGJlIHNhdGlzZmllZCBhbmQNCiJm
bGFncyB8PSBDRkxHU19PRkZfU0xBQiIgd2lsbCBiZSBleGN1dGVkLg0KICAoNSkiaWYgKGZsYWdz
ICYgQ0ZMR1NfT0ZGX1NMQUIpIiB0ZXN0IHdpbGwgYmUgc2F0aXNmaWVkIGFuZCB3aWxsIGdvDQp0
byAiY2FjaGVwLT5zbGFicF9jYWNoZSA9IGttYWxsb2Nfc2xhYihzbGFiX3NpemUsIDB1KSIsIGFu
ZCB0aGUgcmVzdWx0DQpoZXJlIG1heSBiZSBOVUxMIHdoaWxlIGtlcm5lbCBib290dXAuDQogICg2
KUZpbmFsbHksIkJVR19PTihaRVJPX09SX05VTExfUFRSKGNhY2hlcC0+c2xhYnBfY2FjaGUpKTsi
IGNhdXNlIHRoZQ0KQlVHIGluZm8gYXMgdGhlIGZvbGxvd2luZyBzaG93cyhtYXkgYmUgb25seSBt
aXBzNjQgaGFzIHRoaXMgcHJvYmxlbSk6DQoNCiAjMjANCnRhc2s6IGZmZmZmZmZmYzA3MmNkYzAg
dGk6IGZmZmZmZmZmYzA2YjQwMDAgdGFzay50aTogZmZmZmZmZmZjMDZiNDAwMA0KJCAwICAgOiAw
MDAwMDAwMDAwMDAwMDAwIDAwMDAwMDAwMDAwMDAwMTggMDAwMDAwMDAwMDAwMDAwMSANCjAwMDAw
MDAxMDAwMDBmZmYNCiQgNCAgIDogMDAwMDAwMDAwMDAwMDAzMCAwMDAwMDAwMDAwMDAwMDAwIDAw
MDAwMDAwMDAwMDEwMDQgDQowMDAwMDAwMDAwMDAxMDAwDQokIDggICA6IGZmZmZmZmZmODAwMDI4
MDAgMDAwMDAwMDAwMDAwMDAwYiAwMDAwMDAwMDAwMDAwMDAwIA0KMDAwMDAwMDAwMDAwMDAwMA0K
JDEyICAgOiAwMDAwMDAwMDgwMDAwMDAwIDAwMDAwMDAwMDAwMDAwMDAgYzAwMDAwMDBiZjgxOGVi
YyANCmMwMDAwMDAwYmY4MThlYjgNCiQxNiAgIDogYzAwMDAwMDBiZjgxOGVhMCAwMDAwMDAwMDgw
MDAyODAwIDAwMDAwMDAwMDAwMDAwMDAgDQowMDAwMDAwMDAwMDAxMDAwDQokMjAgICA6IDAwMDAw
MDAwMDAwMDAwMzQgMDAwMDAwMDA4MDAwMDAwMCAwMDAwMDAwMDAwMDAwMDAwIA0KMDAwMDAwMDAw
MDAwMDAwNg0KJDI0ICAgOiBmZmZmZmZmZmMxMTYwMDAwIDAwMDAwMDAwMDAwMDAzZjQNCiQyOCAg
IDogZmZmZmZmZmZjMDZiNDAwMCBmZmZmZmZmZmMwNmI3ZDQwIDAwMDAwMDAwMDAwMDIwMDAgDQpm
ZmZmZmZmZmMwMWQwNzdjDQpIaSAgICA6IDAwMDAwMDAwMDAwMDBmZmYNCkxvICAgIDogMDAwMDAw
MDAwMDEwMDAwMA0KZXBjICAgOiBmZmZmZmZmZmMwMWQwNzg0IF9fa21lbV9jYWNoZV9jcmVhdGUr
MHgyYWMvMHg1MzANCiAgICBOb3QgdGFpbnRlZA0KcmEgICAgOiBmZmZmZmZmZmMwMWQwNzdjIF9f
a21lbV9jYWNoZV9jcmVhdGUrMHgyYTQvMHg1MzANClN0YXR1czogMTQxMDAwZTIgICAgICAgIEtY
IFNYIFVYIEtFUk5FTCBFWEwNCkNhdXNlIDogNDA4MDgwMzQNClBySWQgIDogMDAwYzEzMDAgKEJy
b2FkY29tIFhMUElJKQ0KUHJvY2VzcyBzd2FwcGVyIChwaWQ6IDAsIHRocmVhZGluZm89ZmZmZmZm
ZmZjMDZiNDAwMCwgdGFzaz1mZmZmZmZmZmMwNzJjZGMNCiAgICAgICAgMCx0bHM9MDAwMDAwMDAw
MDAwMDAwMCkNCipId1RMUzogZmZmZmZmZmZmYWRlYmVlZg0KU3RhY2sgOiAwMDAwMDAwMGMwNzNi
MDE4IGMwMDAwMDAwYmY4MThlYTAgMDAwMDAwMDAwMDAwMDA0MCANCjAwMDAwMDAwMDAwMDAwMDAN
CiAgICAgICAgZmZmZmZmZmZjMTE1YjM2MCBmZmZmZmZmZmMxMTViMzYwIDAwMDAwMDAwMDAwMDAw
MTcgDQowMDAwMDAwMDAwMDAwMDA3DQogICAgICAgIDAwMDAwMDAwMDAwMDAwMDYgZmZmZmZmZmZj
MDc4MGY1NCAwMDAwMDAwMDAwMDAyMDAwIA0KMDAwMDAwMDAwMDAwMDA0MA0KICAgICAgICBjMDAw
MDAwMGJmODE4ZWEwIDAwMDAwMDAwMDAwMDAwMDAgMDAwMDAwMDAwMDAwMDA0MCANCmZmZmZmZmZm
YzA3ODBmZWMNCiAgICAgICAgMDAwMDAwMDAwMDAwMjAwMCBjMDAwMDAwMGJmODEwZmMwIGZmZmZm
ZmZmYzExNWIzOTAgDQowMDAwMDAwMDAwMDAwMDA2DQogICAgICAgIGZmZmZmZmZmYzExNjAwMDAg
ZmZmZmZmZmZjMDc4MTBiMCAwMDAwMDAwMDAwMDAwMDAxIA0KYzAwMDAwMDBiZjgwOTAwMA0KICAg
ICAgICBmZmZmZmZmZmMwYTMwMDAwIGZmZmZmZmZmYzA3YTAwMDAgZmZmZmZmZmZjMDdhMTc1OCAN
CmZmZmZmZmZmYzBhMzAwMDANCiAgICAgICAgZmZmZmZmZmY4YzE5MDAwMCBmZmZmZmZmZjhiZDAy
OTgzIDAwMDAwMDAwMDAwMDAwMDAgDQpmZmZmZmZmZjhjMThmNzk4DQogICAgICAgIDAwMDAwMDAw
MDAwMDAwMDAgZmZmZmZmZmZjMDc3NDZlMCBmZmZmZmZmZmMwN2ExNzU4IA0KMDAwMDAwMDAwMDAw
MDAwMA0KICAgICAgICAwMDAwMDAwMDAwMDAwMDAwIGZmZmZmZmZmODA1YzU1ODAgMDAwMDAwMDAw
MDAwMDAwMCANCjAwMDAwMDAwMDAwMDAwMDANCiAgICAgICAgICAuLi4NCkNhbGwgVHJhY2U6DQpb
PGZmZmZmZmZmYzAxZDA3ODQ+XSBfX2ttZW1fY2FjaGVfY3JlYXRlKzB4MmFjLzB4NTMwDQpbPGZm
ZmZmZmZmYzA3ODBmNTQ+XSBjcmVhdGVfYm9vdF9jYWNoZSsweDU0LzB4OTANCls8ZmZmZmZmZmZj
MDc4MGZlYz5dIGNyZWF0ZV9rbWFsbG9jX2NhY2hlKzB4NWMvMHg5NA0KWzxmZmZmZmZmZmMwNzgx
MGIwPl0gY3JlYXRlX2ttYWxsb2NfY2FjaGVzKzB4OGMvMHgxYjANCls8ZmZmZmZmZmZjMDc3NDZl
MD5dIHN0YXJ0X2tlcm5lbCsweDFhMC8weDQwOA0KDQpUaGlzIHBhdGNoIGNhbiBmaXggdGhlIHBy
b2JsZW0gb2Yga21hbGxvY19zaXplKElOREVYX05PREUgKyAxKWFuZCB3aWxsDQpyZW1vdmUgdGhl
IEJVRyBhYm92ZSwgSSB0ZXN0IGl0IG9uIG15IG1pcHM2NCBtZWNoaW5lLg0KDQpTaWduZWQtb2Zm
LWJ5OiBMaXVoYWlsb25nIDxsaXUuaGFpbG9uZzZAenRlLmNvbS5jbj4NClJldmlld2VkLWJ5OiBK
aWFuZ3h1ZXhpbiA8amlhbmcueHVleGluQHp0ZS5jb20uY24+DQoNCi0tLQ0KIG1tL3NsYWIuYyB8
ICAgIDIgKy0NCiAxIGZpbGVzIGNoYW5nZWQsIDEgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbnMo
LSkNCg0KZGlmZiAtLWdpdCBhL21tL3NsYWIuYyBiL21tL3NsYWIuYw0KaW5kZXggNjhiOTVhOC4u
ZjFkMzNkOSAxMDA2NDQNCi0tLSBhL21tL3NsYWIuYw0KKysrIGIvbW0vc2xhYi5jDQpAQCAtMjIw
NCw3ICsyMjA0LDcgQEAgX19rbWVtX2NhY2hlX2NyZWF0ZSAoc3RydWN0IGttZW1fY2FjaGUgKmNh
Y2hlcCwgDQp1bnNpZ25lZCBsb25nIGZsYWdzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2l6
ZSArPSBCWVRFU19QRVJfV09SRDsNCiAgICAgICAgfQ0KICNpZiBGT1JDRURfREVCVUcgJiYgZGVm
aW5lZChDT05GSUdfREVCVUdfUEFHRUFMTE9DKQ0KLSAgICAgICBpZiAoc2l6ZSA+PSBrbWFsbG9j
X3NpemUoa21hbGxvY19uZXh0X2luZGV4KElOREVYX05PREUpKQ0KKyAgICAgICBpZiAoc2l6ZSA+
PSBrbWFsbG9jX3NpemUoSU5ERVhfTk9ERSkqMg0KICAgICAgICAgICAgJiYgY2FjaGVwLT5vYmpl
Y3Rfc2l6ZSA+IGNhY2hlX2xpbmVfc2l6ZSgpDQogICAgICAgICAgICAmJiBBTElHTihzaXplLCBj
YWNoZXAtPmFsaWduKSA8IFBBR0VfU0laRSkgew0KICAgICAgICAgICAgICAgIGNhY2hlcC0+b2Jq
X29mZnNldCArPSBQQUdFX1NJWkUgLSBBTElHTihzaXplLCANCmNhY2hlcC0+YWxpZ24pOw0KLS0g
DQoxLjcuMQ0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQ0KWlRFIEluZm9ybWF0aW9uIFNlY3VyaXR5IE5vdGljZTogVGhlIGluZm9ybWF0
aW9uIGNvbnRhaW5lZCBpbiB0aGlzIG1haWwgKGFuZCBhbnkgYXR0YWNobWVudCB0cmFuc21pdHRl
ZCBoZXJld2l0aCkgaXMgcHJpdmlsZWdlZCBhbmQgY29uZmlkZW50aWFsIGFuZCBpcyBpbnRlbmRl
ZCBmb3IgdGhlIGV4Y2x1c2l2ZSB1c2Ugb2YgdGhlIGFkZHJlc3NlZShzKS4gIElmIHlvdSBhcmUg
bm90IGFuIGludGVuZGVkIHJlY2lwaWVudCwgYW55IGRpc2Nsb3N1cmUsIHJlcHJvZHVjdGlvbiwg
ZGlzdHJpYnV0aW9uIG9yIG90aGVyIGRpc3NlbWluYXRpb24gb3IgdXNlIG9mIHRoZSBpbmZvcm1h
dGlvbiBjb250YWluZWQgaXMgc3RyaWN0bHkgcHJvaGliaXRlZC4gIElmIHlvdSBoYXZlIHJlY2Vp
dmVkIHRoaXMgbWFpbCBpbiBlcnJvciwgcGxlYXNlIGRlbGV0ZSBpdCBhbmQgbm90aWZ5IHVzIGlt
bWVkaWF0ZWx5Lg0K

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
