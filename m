Return-Path: <owner-linux-mm@kvack.org>
Received: from psmtp.com (na3sys010amx169.postini.com [74.125.245.169])
	by kanga.kvack.org (Postfix) with SMTP id DCE736B004D
	for <linux-mm@kvack.org>; Thu, 22 Dec 2011 10:35:01 -0500 (EST)
Received: by iacb35 with SMTP id b35so15464912iac.14
        for <linux-mm@kvack.org>; Thu, 22 Dec 2011 07:35:01 -0800 (PST)
Message-ID: <4EF34E1E.6000805@gmail.com>
Date: Thu, 22 Dec 2011 23:34:54 +0800
From: "nai.xia" <nai.xia@gmail.com>
MIME-Version: 1.0
Subject: Re: Question about missing "cld" in x86 string assembly code
References: <201112172258.24221.nai.xia@gmail.com> <CAMzpN2inHxaSnaYaYXZ4Ya3rK+MWXqR6dN5NVNZy3=OvP04uQA@mail.gmail.com>
In-Reply-To: <CAMzpN2inHxaSnaYaYXZ4Ya3rK+MWXqR6dN5NVNZy3=OvP04uQA@mail.gmail.com>
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit
Sender: owner-linux-mm@kvack.org
List-ID: <linux-mm.kvack.org>
To: Brian Gerst <brgerst@gmail.com>
Cc: Andi Kleen <ak@linux.intel.com>, Linus Torvalds <torvalds@linux-foundation.org>, Linux-MM <linux-mm@kvack.org>, LKML <linux-kernel@vger.kernel.org>



On 2011a1'12ae??18ae?JPY 01:08, Brian Gerst wrote:
> On Sat, Dec 17, 2011 at 9:58 AM, Nai Xia<nai.xia@gmail.com>  wrote:
>> Hi Andi,
>>
>> Seems I used a stale email address of you from a related git commit log,
>> so this is a resend, sorry.
>>
>> =======
>> Hi,
>>
>> I notice that all x86 assembly code for string operations containing
>> "scasb, lodsb", etc does not have "cld" at the beginning.
>> Is this 100% safe?
>> Or in other words, how could we be sure that
>> there is no "std" generated by compiler somewhere just before
>> the string operations?
>>
>>
>> Thanks,
>>
>> Nai
>> --
>> To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
>> the body of a message to majordomo@vger.kernel.org
>> More majordomo info at  http://vger.kernel.org/majordomo-info.html
>> Please read the FAQ at  http://www.tux.org/lkml/
>
> The i386 ELF ABI states "The direction flag must be set to the
> a??a??forwarda??a?? (that is, zero) direction before entry and upon exit from
> a function."  Therefore it can be assumed to be clear, unless
> explicitly set.

Hmm, I get those lines now. Thanks for reply.
Seems gcc started to strictly conform to this ABI since 4.3 . But glibc
seems still have some leading "cld" string code, maybe just prepared for
non-conforming kernels other than Linux.

>
> --
> Brian Gerst

--
To unsubscribe, send a message with 'unsubscribe linux-mm' in
the body to majordomo@kvack.org.  For more info on Linux MM,
see: http://www.linux-mm.org/ .
Fight unfair telecom internet charges in Canada: sign http://stopthemeter.ca/
Don't email: <a href=mailto:"dont@kvack.org"> email@kvack.org </a>
